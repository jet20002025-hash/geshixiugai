# 安全配置清单

## ⚠️ 重要：支付信息加密要求

**所有支付相关的敏感信息必须通过环境变量配置，绝对不能硬编码在代码中！**

---

## ✅ 安全检查清单

在提交代码到 GitHub 前，请确认：

### 1. 代码检查

- [ ] 代码中没有硬编码的商户号（如：`mch_id = "1234567890"`）
- [ ] 代码中没有硬编码的API密钥（如：`api_key = "your_key"`）
- [ ] 代码中没有硬编码的AppID（如：`app_id = "2021001234567890"`）
- [ ] 代码中没有硬编码的私钥或公钥
- [ ] 所有敏感信息都通过 `os.getenv()` 读取环境变量

### 2. 配置文件检查

- [ ] 配置说明文件中只使用示例值（如：`你的商户号`、`你的API密钥`）
- [ ] 配置说明文件中没有真实的商户号、密钥、AppID
- [ ] 如果配置文件包含真实信息，已添加到 `.gitignore`

### 3. 环境变量检查

- [ ] 所有支付配置都在 Vercel Dashboard 中配置
- [ ] 本地开发时使用 `.env` 文件（已添加到 `.gitignore`）
- [ ] 没有将 `.env` 文件提交到 Git

### 4. Git 提交检查

- [ ] 运行安全检查脚本：`./scripts/check_secrets.sh`
- [ ] 检查 Git 提交历史中没有敏感信息
- [ ] 如果发现已提交的敏感信息，立即修改密钥并清理历史

---

## 🔍 如何检查

### 方法1：使用安全检查脚本

```bash
./scripts/check_secrets.sh
```

### 方法2：手动检查

```bash
# 检查硬编码的商户号
grep -r "WECHAT_MCH_ID.*=" backend/

# 检查硬编码的AppID
grep -r "ALIPAY_APP_ID.*=" backend/

# 检查环境变量使用
grep -r "os.getenv" backend/
```

---

## 📋 敏感信息清单

以下信息**绝对不能**出现在代码或配置文件中：

### 微信支付
- ❌ `WECHAT_MCH_ID` 的真实值（10位数字）
- ❌ `WECHAT_API_KEY` 的真实值（32位字符串）
- ❌ `WECHAT_APP_ID` 的真实值（如果配置了）

### 支付宝
- ❌ `ALIPAY_APP_ID` 的真实值（16位数字）
- ❌ `ALIPAY_PRIVATE_KEY` 的真实值（RSA私钥）
- ❌ `ALIPAY_PUBLIC_KEY` 的真实值（RSA公钥）

### PayJS
- ❌ `PAYJS_MCHID` 的真实值
- ❌ `PAYJS_KEY` 的真实值

---

## ✅ 正确的做法

### 代码中

```python
# ✅ 正确：使用环境变量
mch_id = os.getenv("WECHAT_MCH_ID")
api_key = os.getenv("WECHAT_API_KEY")

# ❌ 错误：硬编码
mch_id = "1234567890"  # 不要这样做！
api_key = "your_secret_key_here"  # 不要这样做！
```

### 配置文件中

```markdown
# ✅ 正确：使用占位符
WECHAT_MCH_ID=你的商户号
WECHAT_API_KEY=你的API密钥

# ❌ 错误：使用真实值
WECHAT_MCH_ID=1234567890  # 不要这样做！
WECHAT_API_KEY=your_secret_key_here  # 不要这样做！
```

---

## 🚨 如果发现泄漏

### 立即采取的措施

1. **修改密钥**
   - 微信支付：登录商户平台 → API安全 → 修改API密钥
   - 支付宝：登录开放平台 → 重新生成密钥对

2. **清理 Git 历史**（如果已提交）
   ```bash
   # 警告：这会重写 Git 历史，需要强制推送
   git filter-branch --force --index-filter \
     "git rm --cached --ignore-unmatch 包含敏感信息的文件" \
     --prune-empty --tag-name-filter cat -- --all
   ```

3. **通知相关人员**
   - 检查是否有异常交易
   - 监控账户状态

---

## 📝 定期检查

建议每次提交代码前都运行安全检查脚本：

```bash
./scripts/check_secrets.sh
```

如果脚本报告问题，请立即修复后再提交。

---

## 📚 相关文档

- [安全配置指南.md](./安全配置指南.md) - 详细的安全实践
- [微信支付配置说明.md](./微信支付配置说明.md) - 配置步骤（使用示例值）
- [支付宝配置说明.md](./支付宝配置说明.md) - 配置步骤（使用示例值）

---

**记住：安全第一！保护密钥就是保护资金！**


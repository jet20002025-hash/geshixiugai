# æ”¯ä»˜å®æ”¯ä»˜é…ç½®éªŒè¯

## âœ… é…ç½®å·²å®Œæˆ

ä½ å·²ç»é…ç½®å¥½äº†æ”¯ä»˜å®æ”¯ä»˜ç¯å¢ƒå˜é‡ï¼Œç°åœ¨éœ€è¦éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ã€‚

---

## ğŸš€ éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1ï¼šç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆé˜¿é‡Œäº‘æ§åˆ¶å°çš„å¯¹è¯æ¡†é‡Œï¼‰ï¼š

```bash
# ç¡®ä¿ .env æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆæœåŠ¡éœ€è¦è¯»å–ï¼‰
sudo chown nginx:nginx /var/www/geshixiugai/.env
sudo chmod 600 /var/www/geshixiugai/.env
```

### æ­¥éª¤ 2ï¼šé‡å¯æœåŠ¡

```bash
sudo systemctl restart geshixiugai
sudo systemctl status geshixiugai
```

### æ­¥éª¤ 3ï¼šæŸ¥çœ‹æ—¥å¿—ç¡®è®¤é…ç½®åŠ è½½

```bash
# æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤æ”¯ä»˜å®é…ç½®åŠ è½½æˆåŠŸ
sudo tail -n 50 /var/log/geshixiugai/error.log | grep -i alipay
```

åº”è¯¥çœ‹åˆ°ï¼š`[AlipayService] æ”¯ä»˜å®å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ`

---

## âœ… éªŒè¯é…ç½®

### æ–¹æ³• 1ï¼šè®¿é—®è°ƒè¯•ç«¯ç‚¹ï¼ˆæ¨èï¼‰

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
https://geshixiugai.cn/payments/debug/config
```

åº”è¯¥è¿”å› JSONï¼ŒåŒ…å«æ”¯ä»˜å®é…ç½®ä¿¡æ¯ï¼š
```json
{
  "alipay": {
    "app_id_exists": true,
    "app_id_preview": "2021****",
    "private_key_exists": true,
    "private_key_length": æ•°å­—,
    "private_key_has_begin": true/false,
    "public_key_exists": true,
    "public_key_length": æ•°å­—,
    "public_key_has_begin": true/false,
    "sign_type": "RSA2",
    "gateway": "https://openapi.alipay.com/gateway.do",
    "configured": true
  },
  "available_payment_methods": ["mock", "alipay", ...]
}
```

**æ£€æŸ¥è¦ç‚¹**ï¼š
- âœ… `app_id_exists: true` - AppID å·²é…ç½®
- âœ… `private_key_exists: true` - ç§é’¥å·²é…ç½®
- âœ… `public_key_exists: true` - å…¬é’¥å·²é…ç½®
- âœ… `configured: true` - é…ç½®å®Œæ•´
- âœ… `alipay` åœ¨ `available_payment_methods` ä¸­ - æ”¯ä»˜æ–¹å¼å¯ç”¨

### æ–¹æ³• 2ï¼šæµ‹è¯•æ”¯ä»˜æµç¨‹

1. **è®¿é—®ç½‘ç«™**ï¼šhttps://geshixiugai.cn
2. **ä¸Šä¼ æ¨¡æ¿å’Œæ–‡æ¡£**ï¼šå®Œæˆæ–‡æ¡£å¤„ç†
3. **è¿›å…¥æ”¯ä»˜é¡µé¢**ï¼šæŸ¥çœ‹æ”¯ä»˜ä¿¡æ¯
4. **é€‰æ‹©æ”¯ä»˜æ–¹å¼**ï¼šåº”è¯¥èƒ½çœ‹åˆ°"æ”¯ä»˜å®"é€‰é¡¹
5. **ç‚¹å‡»"ç«‹å³æ”¯ä»˜"**ï¼šåº”è¯¥è·³è½¬åˆ°æ”¯ä»˜å®æ”¯ä»˜é¡µé¢

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šé…ç½®æœªç”Ÿæ•ˆ

```bash
# æ£€æŸ¥ .env æ–‡ä»¶å†…å®¹ï¼ˆä¸æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯ï¼‰
cd /var/www/geshixiugai
grep "^ALIPAY" .env | sed 's/=.*/=***/'  # åªæ˜¾ç¤ºé…ç½®é¡¹åç§°ï¼Œéšè—å€¼
```

### é—®é¢˜ 2ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u geshixiugai -n 100 --no-pager | grep -i alipay
```

### é—®é¢˜ 3ï¼šæ”¯ä»˜å®å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -n 100 /var/log/geshixiugai/error.log | grep -i -A 5 "alipay"
```

å¸¸è§é”™è¯¯ï¼š
- ç§é’¥æ ¼å¼ä¸æ­£ç¡®
- å…¬é’¥æ ¼å¼ä¸æ­£ç¡®
- AppID ä¸ç§é’¥ä¸åŒ¹é…

---

## ğŸ“‹ å®Œæ•´éªŒè¯å‘½ä»¤

```bash
# 1. ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®
sudo chown nginx:nginx /var/www/geshixiugai/.env
sudo chmod 600 /var/www/geshixiugai/.env

# 2. é‡å¯æœåŠ¡
sudo systemctl restart geshixiugai

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai

# 4. æŸ¥çœ‹æ—¥å¿—
sudo tail -n 50 /var/log/geshixiugai/error.log | grep -i alipay
```

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

- [ ] .env æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆnginx:nginx, 600ï¼‰
- [ ] æœåŠ¡å·²é‡å¯
- [ ] æ—¥å¿—æ˜¾ç¤ºæ”¯ä»˜å®å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ
- [ ] è°ƒè¯•ç«¯ç‚¹æ˜¾ç¤º `configured: true`
- [ ] æ”¯ä»˜é¡µé¢æ˜¾ç¤º"æ”¯ä»˜å®"é€‰é¡¹
- [ ] ç‚¹å‡»æ”¯ä»˜èƒ½è·³è½¬åˆ°æ”¯ä»˜å®æ”¯ä»˜é¡µé¢

---

**ç°åœ¨æ‰§è¡ŒéªŒè¯æ­¥éª¤ï¼** ğŸ”






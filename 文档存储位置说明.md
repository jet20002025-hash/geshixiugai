# 文档存储位置说明

## 📁 文档存储位置

在服务器上，文档存储在：

```
/var/www/geshixiugai/storage/documents/
```

每个文档都有一个唯一的ID作为目录名，例如：

```
/var/www/geshixiugai/storage/documents/44f883d8c91c4524be75d9d6772af198/
├── original.docx      # 原始上传的文档
├── preview.docx       # 带水印的预览版（用于转换PDF）
├── final.docx         # 最终修复后的文档
├── preview.html       # HTML预览
├── preview.pdf        # PDF预览（LibreOffice生成）
├── metadata.json      # 文档元数据
└── report.json        # 处理报告
```

## 🔍 如何找到测试文档

### 方法1: 查看最新的文档目录

```bash
cd /var/www/geshixiugai/storage/documents

# 按修改时间排序，查看最新的文档
ls -lt | head -10

# 或者查看所有文档ID
ls -d */
```

### 方法2: 从日志中获取文档ID

上传文档后，日志中会显示文档ID：

```
[DocumentService] 文档ID: 44f883d8c91c4524be75d9d6772af198
```

### 方法3: 查看所有文档

```bash
cd /var/www/geshixiugai/storage/documents

# 列出所有文档目录
ls -d */

# 查看某个文档的内容
ls -lh 44f883d8c91c4524be75d9d6772af198/
```

## 🧪 手动测试 LibreOffice 转换

找到测试文档后，可以手动测试 LibreOffice 转换：

```bash
# 1. 进入文档目录
cd /var/www/geshixiugai/storage/documents

# 2. 找一个测试文档（使用最新的或指定的文档ID）
DOC_ID="44f883d8c91c4524be75d9d6772af198"  # 替换为实际的文档ID

# 3. 检查文档是否存在
ls -lh $DOC_ID/preview.docx

# 4. 手动执行 LibreOffice 转换
cd $DOC_ID
libreoffice --headless --convert-to pdf --outdir . preview.docx

# 5. 检查是否生成 PDF
ls -lh *.pdf

# 6. 查看 PDF 文件信息
file preview.pdf
```

## 📊 查看文档处理状态

```bash
# 查看文档元数据
cat /var/www/geshixiugai/storage/documents/文档ID/metadata.json | python3 -m json.tool

# 查看处理报告
cat /var/www/geshixiugai/storage/documents/文档ID/report.json | python3 -m json.tool
```

## 🔧 测试 LibreOffice 转换（完整步骤）

```bash
# 1. 切换到项目目录
cd /var/www/geshixiugai

# 2. 找一个测试文档（使用最新的文档）
LATEST_DOC=$(ls -t storage/documents/ | head -1)
echo "测试文档ID: $LATEST_DOC"

# 3. 进入文档目录
cd storage/documents/$LATEST_DOC

# 4. 检查 preview.docx 是否存在
if [ -f "preview.docx" ]; then
    echo "✅ 找到 preview.docx"
    ls -lh preview.docx
    
    # 5. 手动执行 LibreOffice 转换
    echo "开始转换..."
    libreoffice --headless --convert-to pdf --outdir . preview.docx
    
    # 6. 检查结果
    if [ -f "preview.pdf" ]; then
        echo "✅ PDF 生成成功！"
        ls -lh preview.pdf
    else
        echo "❌ PDF 生成失败"
        echo "检查 LibreOffice 输出..."
    fi
else
    echo "❌ preview.docx 不存在"
fi
```

## 📝 注意事项

1. **权限问题**：确保运行服务的用户有读写权限
2. **路径问题**：使用绝对路径更可靠
3. **环境变量**：LibreOffice 需要正确的 PATH 环境变量

## 🐛 如果手动测试成功但代码失败

如果手动测试 LibreOffice 转换成功，但代码中失败，可能是：

1. **环境变量问题**：代码中的 PATH 不完整
2. **用户权限问题**：运行服务的用户权限不足
3. **工作目录问题**：需要在正确的目录执行

请提供手动测试的结果，我会根据实际情况调整代码。





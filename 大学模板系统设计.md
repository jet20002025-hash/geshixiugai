# 大学模板系统设计方案

## 📋 设计目标

**用户角度**：一个大学一个模板，选择简单直观
**开发者角度**：只维护参数配置，无需改代码

## 🎯 核心思路

采用 **"预设模板库 + 参数化配置"** 的混合方案：

1. **预设模板库**：维护常见大学的模板配置（JSON格式）
2. **参数化配置**：每个模板只包含可配置参数（行距、页边距等）
3. **用户选择**：前端显示"选择您的大学"，选择后应用对应参数
4. **向后兼容**：保留用户上传自定义模板的功能

## 📊 系统架构

```
前端界面
  ├─ 选择大学（预设模板）
  │   ├─ 清华大学
  │   ├─ 北京大学
  │   ├─ 浙江大学
  │   └─ ...（可扩展）
  │
  └─ 上传自定义模板（保留原有功能）

后端处理
  ├─ 预设模板服务
  │   └─ 读取 university_templates.json
  │
  ├─ 自定义模板服务（现有）
  │   └─ 解析用户上传的模板
  │
  └─ 文档处理服务
      └─ 应用模板参数到文档
```

## 🔧 技术实现

### 1. 模板配置文件结构

**文件位置**：`backend/app/services/university_templates.json`

```json
{
  "universities": [
    {
      "id": "tsinghua",
      "name": "清华大学",
      "display_name": "清华大学",
      "description": "清华大学毕业论文格式规范",
      "parameters": {
        "body_text": {
          "line_spacing": 22,  // 22磅行距（主要差异）
          "font_size": 12,
          "font_name": "宋体",
          "first_line_indent": 24
        },
        "page_settings": {
          "margins": {
            "top": 3.0,
            "bottom": 2.0,
            "left": 3.0,
            "right": 2.0
          }
        }
      }
    },
    {
      "id": "pku",
      "name": "北京大学",
      "display_name": "北京大学",
      "parameters": {
        "body_text": {
          "line_spacing": 20,  // 20磅行距
          "font_size": 12,
          "font_name": "宋体"
        }
      }
    }
  ]
}
```

### 2. 参数优先级

```
1. 预设模板参数（如果选择了大学）
2. 用户上传模板参数（如果上传了自定义模板）
3. 系统默认标准（thesis_format_standard.py）
```

### 3. 前端交互流程

```
用户进入页面
  ↓
选择"使用预设模板"或"上传自定义模板"
  ↓
如果选择预设模板：
  - 显示大学选择下拉框
  - 用户选择大学
  - 提交时传递 university_id
  ↓
如果选择自定义模板：
  - 显示文件上传（现有功能）
  - 提交时传递 template_id
```

## 📝 实现步骤

### Phase 1: 后端支持预设模板
1. 创建 `university_templates.json` 配置文件
2. 创建 `UniversityTemplateService` 服务类
3. 修改 `DocumentService` 支持预设模板参数
4. 添加 API 端点：`GET /api/templates/presets` 获取预设模板列表

### Phase 2: 前端界面优化
1. 添加"模板类型"选择（预设/自定义）
2. 添加大学选择下拉框
3. 根据选择显示/隐藏相应表单
4. 修改提交逻辑，支持 `university_id` 参数

### Phase 3: 参数应用逻辑
1. 修改 `_apply_rules` 方法，支持预设模板参数
2. 实现参数合并逻辑（预设 > 自定义 > 默认）
3. 确保向后兼容

## 🎨 用户体验优化

1. **智能推荐**：根据用户IP或历史记录推荐大学
2. **快速搜索**：大学选择框支持搜索
3. **参数预览**：选择大学后显示主要参数（行距、字体等）
4. **自定义覆盖**：允许用户在预设模板基础上微调参数

## 🔄 扩展性

- **添加新大学**：只需在 `university_templates.json` 中添加一条记录
- **修改参数**：直接编辑 JSON 文件，无需改代码
- **批量导入**：支持从 Excel/CSV 批量导入大学模板

## 📈 未来优化方向

1. **用户贡献**：允许用户提交自己学校的模板配置
2. **模板市场**：建立模板分享平台
3. **智能识别**：从用户上传的文档中自动识别大学格式
4. **参数对比**：显示不同大学格式的差异对比











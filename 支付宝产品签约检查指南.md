# 支付宝产品签约检查指南

## 问题说明

如果遇到 `insufficient-isv-permissions` 错误，通常是因为**应用没有签约相应的支付产品**。

## 关键概念

### 应用类型 vs 支付产品

- **应用类型**：创建应用时选择的类型（如"网页应用"、"移动应用"）
- **支付产品**：需要单独签约的产品（如"电脑网站支付"、"手机网站支付"）

**重要**：应用类型和支付产品必须匹配！

| 应用类型 | 应该签约的产品 | 接口名称 |
|---------|--------------|---------|
| **网页应用** | **电脑网站支付** | `alipay.trade.page.pay` |
| **移动应用** | **手机网站支付** | `alipay.trade.wap.pay` |

---

## 检查步骤

### 步骤 1：登录支付宝开放平台

1. 访问：https://open.alipay.com/
2. 使用支付宝账号登录
3. 进入"控制台"

### 步骤 2：查看应用信息

1. 在控制台首页，点击"**网页&移动应用**"
2. 找到你的应用（应用名称：诚叔工具站，AppID：2021006109680085）
3. 点击进入应用详情

### 步骤 3：确认应用类型

在应用详情页面，查看应用类型：
- ✅ **网页应用** → 需要签约"**电脑网站支付**"产品
- ✅ **移动应用** → 需要签约"**手机网站支付**"产品

### 步骤 4：检查产品列表

1. 在应用详情页面，找到"**产品列表**"或"**功能列表**"
2. 查看已签约的产品

**需要确认**：
- 如果应用类型是"**网页应用**"，产品列表中应该有"**电脑网站支付**"且状态为"**已上线**"
- 如果应用类型是"**移动应用**"，产品列表中应该有"**手机网站支付**"且状态为"**已上线**"

---

## 如何签约产品

### 如果应用类型是"网页应用"（你的情况）

需要签约"**电脑网站支付**"产品：

1. **进入产品管理**
   - 在应用详情页面，找到"**产品列表**"或"**功能列表**"
   - 点击"**添加产品**"或"**签约产品**"

2. **选择产品**
   - 在产品列表中，找到"**电脑网站支付**"
   - 点击"**立即签约**"或"**查看详情**"

3. **填写签约信息**
   - 填写产品使用场景（如：论文格式修复服务）
   - 填写网站信息：`https://geshixiugai.org`
   - 提交签约申请

4. **等待审核**
   - 审核时间：几小时到1个工作日
   - 审核通过后，产品状态会变为"**已上线**"

### 如果应用类型是"移动应用"

需要签约"**手机网站支付**"产品（步骤同上，选择"手机网站支付"）

---

## 常见问题

### Q1: 产品列表在哪里？

**A**: 
- 在应用详情页面，通常有"**产品列表**"、"**功能列表**"或"**接口管理**"等入口
- 如果找不到，可以尝试：
  1. 应用详情 → 左侧菜单 → 查找"产品"或"功能"
  2. 或者联系支付宝客服：95188

### Q2: 只看到"手机网站支付"，没有"电脑网站支付"？

**A**: 
- 如果应用类型是"网页应用"，必须签约"电脑网站支付"
- 如果产品列表中没有"电脑网站支付"，可能的原因：
  1. 应用类型不对（需要确认应用类型）
  2. 产品还未开放（联系支付宝客服）
  3. 需要先完成其他条件（如企业认证）

### Q3: 产品已签约，但状态是"审核中"？

**A**: 
- 需要等待审核通过
- 只有产品状态为"**已上线**"时，才能正常使用
- 审核时间：几小时到1个工作日

### Q4: 产品已上线，但仍然报错？

**A**: 
请检查：
1. ✅ 应用状态是否为"已上线"（不是"审核通过"）
2. ✅ 产品状态是否为"已上线"
3. ✅ 代码中使用的接口是否与产品匹配
   - 网页应用 → 使用 `api_alipay_trade_page_pay`（电脑网站支付）
   - 移动应用 → 使用 `api_alipay_trade_wap_pay`（手机网站支付）
4. ✅ 环境变量 `ALIPAY_GATEWAY` 是否为正式环境地址
5. ✅ 是否已重新部署 Vercel 项目

---

## 快速检查清单

请按以下清单逐一检查：

- [ ] **应用状态**：已上线 ✅
- [ ] **应用类型**：网页应用 ✅
- [ ] **产品签约**：已签约"电脑网站支付"产品
- [ ] **产品状态**：已上线
- [ ] **代码接口**：使用 `api_alipay_trade_page_pay`（电脑网站支付）
- [ ] **环境变量**：`ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do`
- [ ] **已重新部署**：Vercel 项目已重新部署

---

## 下一步

1. **立即检查产品列表**
   - 登录支付宝开放平台
   - 进入应用详情 → 产品列表
   - 确认是否已签约"**电脑网站支付**"产品

2. **如果未签约，立即签约**
   - 按照上面的步骤签约"电脑网站支付"产品
   - 等待审核通过（几小时到1个工作日）

3. **如果已签约，检查状态**
   - 确认产品状态为"已上线"
   - 确认代码已修改为使用电脑网站支付接口
   - 重新部署 Vercel 项目

4. **测试支付功能**
   - 部署完成后，测试支付功能
   - 如果仍有问题，查看 Vercel 日志

---

## 联系支持

如果以上步骤都已确认无误，但仍报错：

1. **准备信息**
   - 应用 AppID：2021006109680085
   - 应用类型：网页应用
   - 应用状态：已上线
   - 产品列表截图（显示已签约的产品）
   - 完整的错误信息

2. **联系支付宝客服**
   - 客服电话：95188
   - 在线客服：https://open.alipay.com/ → 右上角"帮助中心" → "在线客服"
   - 说明：应用类型是"网页应用"，已签约"电脑网站支付"产品，但仍报 ISV 权限不足错误

---

**重要提示**：网页应用必须签约"电脑网站支付"产品，不能使用"手机网站支付"产品！




# 服务器更新代码 - 预览修复

## 更新步骤

### 1. 连接到服务器
```bash
ssh admin@121.199.49.1
```

### 2. 进入项目目录
```bash
cd /var/www/geshixiugai
```

### 3. 更新代码
```bash
git pull origin main
```

### 4. 重启服务
```bash
sudo systemctl restart geshixiugai
```

### 5. 检查服务状态
```bash
sudo systemctl status geshixiugai
```

## 如果 git pull 失败

### 方法1：强制拉取（推荐）
```bash
git fetch origin
git reset --hard origin/main
```

### 方法2：检查是否有本地修改
```bash
git status
# 如果有未提交的修改，先保存或丢弃
git stash  # 保存修改
# 或
git reset --hard  # 丢弃修改
```

## 验证更新

### 检查文件是否更新
```bash
grep -n "PDF.js库已加载" frontend/preview.html
```

如果看到输出，说明文件已更新。

### 查看服务日志
```bash
sudo journalctl -u geshixiugai -n 50 --no-pager
```

## 测试预览功能

1. 打开浏览器，访问预览页面
2. 按 F12 打开开发者工具
3. 查看 Console 标签，应该能看到详细的调试日志：
   - `开始加载预览，文档ID: ...`
   - `PDF Blob大小: ... bytes`
   - `PDF.js库已加载，版本: ...`
   - `PDF文档加载成功，总页数: ...`

## 如果仍然空白

请检查浏览器控制台的错误信息，并告诉我：
1. 是否有红色错误？
2. 日志停在哪一步？
3. Network 标签中预览请求的状态码是什么？





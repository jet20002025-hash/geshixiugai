# 部署测试检查清单

## ✅ 已完成

- [x] 代码已提交到 Git
- [x] 代码已推送到 GitHub
- [x] 本次更新内容：
  - ✅ 正文固定行距20磅（标题、图片、公式除外）
  - ✅ 图片检测从正文开始（跳过封面、目录）
  - ✅ 添加存储配置调试端点

---

## 📋 部署检查步骤

### 1. 检查 Vercel 自动部署状态

1. **访问 Vercel Dashboard**：https://vercel.com/dashboard
2. **选择项目**：`geshixiugai`
3. **查看 Deployments**：
   - 应该能看到最新的部署（刚刚推送的）
   - 等待部署完成（状态变为 "Ready"）
   - 如果失败，查看日志排查问题

---

### 2. 验证存储配置

部署完成后，访问存储配置调试端点：

```
https://geshixiugai.org/documents/debug/storage
```

或者：

```
https://geshixiugai-app.vercel.app/documents/debug/storage
```

**预期结果**：
- `storage_available: true`
- `storage_type: "Cloudflare R2"`
- `r2.configured: true`
- `r2.available: true`

---

### 3. 测试新功能

#### 测试 1：正文行距20磅

1. **上传测试文档**（包含正文、标题、图片、公式）
2. **下载处理后的文档**
3. **检查正文段落**：
   - ✅ 正文段落行距应为固定20磅
   - ✅ 标题段落行距保持原样
   - ✅ 包含图片的段落行距保持原样
   - ✅ 包含公式的段落行距保持原样

#### 测试 2：图片检测从正文开始

1. **上传测试文档**（包含封面图片、目录、正文图片）
2. **查看检测报告**
3. **检查结果**：
   - ✅ 正文中的图片会被检测
   - ✅ 封面、目录中的图片不会被检测
   - ✅ 只显示正文中缺少图题的图片

---

### 4. 功能验证清单

#### 正文行距功能
- [ ] 正文段落行距为固定20磅
- [ ] 标题段落行距不受影响
- [ ] 包含图片的段落行距不受影响
- [ ] 包含公式的段落行距不受影响

#### 图片检测功能
- [ ] 正文中的图片会被检测
- [ ] 封面中的图片不会被检测
- [ ] 目录中的图片不会被检测
- [ ] 图题检测逻辑正常工作

#### 存储配置
- [ ] 存储配置调试端点可访问
- [ ] R2 存储配置正确
- [ ] 文件上传到 R2 成功

---

## 🔍 如果部署失败

### 检查 Vercel 日志

1. 在 Vercel Dashboard → Deployments → 选择失败的部署
2. 查看 **Logs** 标签
3. 查找错误信息

### 常见问题

#### 问题 1：导入错误

**错误信息**：`ModuleNotFoundError` 或 `ImportError`

**解决方法**：
- 检查 `requirements.txt` 是否包含所有依赖
- 检查 Python 版本是否正确（应该是 3.12）

#### 问题 2：环境变量未设置

**错误信息**：`KeyError` 或配置相关的错误

**解决方法**：
- 在 Vercel Dashboard → Settings → Environment Variables 中检查
- 确保所有 R2 相关环境变量都已设置

#### 问题 3：存储连接失败

**错误信息**：`R2 upload error` 或 `AccessDenied`

**解决方法**：
- 检查 R2 环境变量是否正确
- 检查 R2 Bucket 是否存在
- 检查 API Token 权限是否正确

---

## 🧪 测试用例

### 测试文档要求

建议准备一个包含以下内容的测试文档：

1. **封面页**（包含图片，不应被检测）
2. **目录页**（包含图片，不应被检测）
3. **正文部分**：
   - 标题段落（行距应保持原样）
   - 正文段落（行距应为固定20磅）
   - 包含图片的段落（行距应保持原样，图片应被检测）
   - 包含公式的段落（行距应保持原样）
   - 缺少图题的图片（应被检测并报告）

---

## 📝 测试结果记录

### 测试时间
- 日期：_____________
- 时间：_____________

### 测试结果

#### 正文行距
- [ ] ✅ 通过
- [ ] ❌ 失败（问题：_____________）

#### 图片检测
- [ ] ✅ 通过
- [ ] ❌ 失败（问题：_____________）

#### 存储配置
- [ ] ✅ 通过
- [ ] ❌ 失败（问题：_____________）

### 备注
_________________________________________________

---

## 🎯 下一步

部署测试完成后：

1. ✅ **如果所有测试通过**：
   - 功能已成功部署
   - 可以开始正常使用

2. ❌ **如果测试失败**：
   - 查看 Vercel 日志
   - 检查环境变量配置
   - 告诉我具体的错误信息，我会帮你排查

---

**现在去 Vercel Dashboard 检查部署状态吧！** 🚀





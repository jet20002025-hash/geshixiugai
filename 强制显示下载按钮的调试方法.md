# å¼ºåˆ¶æ˜¾ç¤ºä¸‹è½½æŒ‰é’®çš„è°ƒè¯•æ–¹æ³•

## ğŸ” é—®é¢˜

æ”¯ä»˜æˆåŠŸåï¼Œä¸‹è½½æŒ‰é’®æ²¡æœ‰æ˜¾ç¤ºã€‚

---

## ğŸ› ï¸ è°ƒè¯•æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°

1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° **Consoleï¼ˆæ§åˆ¶å°ï¼‰** æ ‡ç­¾

### æ­¥éª¤ 2ï¼šæ£€æŸ¥æ—¥å¿—

æ”¯ä»˜æˆåŠŸåï¼Œåº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š

```
æ£€æµ‹åˆ°æ”¯ä»˜å®æ”¯ä»˜å›è°ƒï¼Œè®¢å•å·: xxx
å¼€å§‹åˆ·æ–°æ–‡æ¡£çŠ¶æ€ï¼ŒdocumentId: xxx
ç»“æœå¡ç‰‡å·²æ˜¾ç¤º
æ–‡æ¡£è¯¦æƒ…æ•°æ®: { ... }
æ–‡æ¡£å·²æ”¯ä»˜ï¼Œå‡†å¤‡æ˜¾ç¤ºä¸‹è½½æŒ‰é’® { document_id: "...", download_token: "..." }
ä¸‹è½½æŒ‰é’®å·²æ·»åŠ  { href: "...", hasToken: true/false }
æ”¯ä»˜çŠ¶æ€åˆ·æ–°å®Œæˆ
```

### æ­¥éª¤ 3ï¼šæ‰‹åŠ¨æ£€æŸ¥

åœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆæ›¿æ¢ä¸ºä½ çš„æ–‡æ¡£IDï¼‰ï¼š

```javascript
// 1. æ£€æŸ¥æ–‡æ¡£çŠ¶æ€
fetch('/documents/ä½ çš„æ–‡æ¡£ID')
  .then(r => r.json())
  .then(data => {
    console.log('æ–‡æ¡£çŠ¶æ€:', data);
    console.log('å·²æ”¯ä»˜:', data.paid);
    console.log('ä¸‹è½½token:', data.download_token);
  });

// 2. æ£€æŸ¥é¢„è§ˆé“¾æ¥å…ƒç´ 
const previewLinks = document.getElementById('previewLinks');
console.log('previewLinks å…ƒç´ :', previewLinks);
console.log('previewLinks å­å…ƒç´ :', previewLinks?.children);

// 3. æ£€æŸ¥ç»“æœå¡ç‰‡
const resultCard = document.getElementById('result');
console.log('resultCard æ˜¾ç¤ºçŠ¶æ€:', resultCard?.style.display);
console.log('resultCard æ˜¯å¦å¯è§:', resultCard?.offsetParent !== null);
```

### æ­¥éª¤ 4ï¼šæ‰‹åŠ¨æ·»åŠ ä¸‹è½½æŒ‰é’®

å¦‚æœæŒ‰é’®ç¡®å®æ²¡æœ‰æ˜¾ç¤ºï¼Œå¯ä»¥æ‰‹åŠ¨æ·»åŠ ï¼š

```javascript
// æ›¿æ¢ä¸ºä½ çš„æ–‡æ¡£IDå’Œtoken
const documentId = 'ä½ çš„æ–‡æ¡£ID';
const token = 'ä½ çš„tokenæˆ–æ–‡æ¡£ID';

const previewLinks = document.getElementById('previewLinks');
if (previewLinks) {
  // æ£€æŸ¥æ˜¯å¦å·²æœ‰æŒ‰é’®
  const existingBtn = previewLinks.querySelector('.download-btn');
  if (!existingBtn) {
    const finalLink = document.createElement('a');
    finalLink.href = `/documents/${documentId}/download?token=${token}`;
    finalLink.textContent = 'ä¸‹è½½æ­£å¼ç‰ˆï¼ˆå·²ä»˜è´¹ï¼‰';
    finalLink.target = '_blank';
    finalLink.className = 'download-btn';
    finalLink.style.cssText = 'margin-left: 10px; padding: 10px 20px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px; display: inline-block; font-weight: bold; cursor: pointer;';
    previewLinks.appendChild(finalLink);
    console.log('æ‰‹åŠ¨æ·»åŠ ä¸‹è½½æŒ‰é’®æˆåŠŸ');
  } else {
    console.log('ä¸‹è½½æŒ‰é’®å·²å­˜åœ¨');
  }
} else {
  console.error('previewLinks å…ƒç´ ä¸å­˜åœ¨');
}
```

---

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### 1. æ·»åŠ äº†æ›´å¤šæ£€æŸ¥
- âœ… æ£€æŸ¥ `previewLinks` å…ƒç´ æ˜¯å¦å­˜åœ¨
- âœ… æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ ä¸‹è½½æŒ‰é’®ï¼ˆé¿å…é‡å¤ï¼‰
- âœ… ç¡®ä¿ç»“æœå¡ç‰‡æ˜¾ç¤º

### 2. æ·»åŠ äº†åŒé‡ä¿é™©
- âœ… æ”¯ä»˜æˆåŠŸåï¼Œå»¶è¿Ÿ1ç§’å†æ¬¡æ£€æŸ¥å¹¶æ·»åŠ æŒ‰é’®
- âœ… å³ä½¿ç¬¬ä¸€æ¬¡å¤±è´¥ï¼Œä¹Ÿä¼šå°è¯•æ·»åŠ 

### 3. æ·»åŠ äº†è¯¦ç»†æ—¥å¿—
- âœ… æ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ—¥å¿—è¾“å‡º
- âœ… æ–¹ä¾¿æ’æŸ¥é—®é¢˜

---

## ğŸ“‹ æ›´æ–°ä»£ç 

### åœ¨ä½ çš„ç”µè„‘ä¸Š

```bash
cd /Users/zwj/wordæ ¼å¼ä¿®æ”¹å™¨
git add frontend/index.html
git commit -m "ä¼˜åŒ–ï¼šæ”¯ä»˜æˆåŠŸåå¼ºåˆ¶æ˜¾ç¤ºä¸‹è½½æŒ‰é’®ï¼Œæ·»åŠ åŒé‡ä¿é™©å’Œè¯¦ç»†æ—¥å¿—"
git push origin main
```

### åœ¨æœåŠ¡å™¨ä¸Š

```bash
cd /var/www/geshixiugai
git pull origin main
sudo systemctl restart geshixiugai
```

---

## âœ… éªŒè¯

æ›´æ–°åï¼Œæ”¯ä»˜æˆåŠŸåº”è¯¥ï¼š
1. åœ¨æ§åˆ¶å°çœ‹åˆ°è¯¦ç»†çš„æ—¥å¿—
2. çœ‹åˆ°"ä¸‹è½½æ­£å¼ç‰ˆï¼ˆå·²ä»˜è´¹ï¼‰"æŒ‰é’®
3. ç‚¹å‡»æŒ‰é’®å¯ä»¥ä¸‹è½½

å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œè¯·ï¼š
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
2. å¤åˆ¶æ‰€æœ‰æ—¥å¿—ä¿¡æ¯
3. å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯

---

**ç°åœ¨æ‰§è¡Œï¼šæ›´æ–°ä»£ç ï¼Œç„¶åæµ‹è¯•æ”¯ä»˜æµç¨‹ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼** ğŸ”





# 个体工商户支付申请指南

## 一、申请微信支付商户号

### 1.1 申请入口

**官网**：https://pay.weixin.qq.com/

### 1.2 申请步骤

1. **注册账号**
   - 访问微信支付商户平台
   - 使用微信扫码登录
   - 选择"注册微信支付商户号"

2. **选择主体类型**
   - 选择"个体工商户"
   - 填写营业执照信息

3. **填写资料**
   - 营业执照信息
   - 法人信息
   - 结算账户信息（银行卡）
   - 联系人信息

4. **上传资料**
   - 营业执照照片
   - 法人身份证正反面
   - 结算账户证明（银行卡照片或银行开户证明）

5. **等待审核**
   - 审核时间：1-3 个工作日
   - 审核通过后，会收到微信支付商户号

### 1.3 获取配置信息

审核通过后，登录微信支付商户平台（https://pay.weixin.qq.com/），按以下步骤获取配置信息：

#### 1.3.1 获取商户号（mch_id）

**位置**：商户平台首页

**步骤**：
1. 登录微信支付商户平台
2. 在首页顶部或左侧菜单可以看到"商户号"
3. 商户号格式通常为：`1234567890`（10位数字）
4. **复制保存**这个商户号，这就是 `WECHAT_MCH_ID`

**示例**：
```
商户号：1234567890
```

---

#### 1.3.2 设置并获取 API密钥（key）

**位置**：账户中心 → API安全 → API密钥

**重要说明**：
- 微信支付有两个版本的API：**API v2** 和 **API v3**
- 对于 **H5支付（网页支付）**，我们使用 **API v2** 接口
- 需要的是：**商户API v2密钥**（不是v3密钥）

**步骤**：
1. 登录商户平台
2. 点击顶部菜单"账户中心"
3. 在左侧菜单选择"API安全"
4. 点击"**API密钥**"选项卡（这是API v2密钥）
5. 点击"设置"或"修改"按钮
6. 输入32位密钥（可以随机生成，建议使用字母+数字组合）
   - 示例：`a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6`
7. 确认设置
8. **重要**：密钥设置后只显示一次，请立即复制保存！
9. 这就是 `WECHAT_API_KEY`（API v2密钥）

**你需要提供的是**：
- ✅ **商户API v2密钥** ← 这个！
- ❌ 商户API证书（不需要，基础支付不需要证书）
- ❌ 微信支付公钥（不需要，这是API v3用的）
- ❌ 解密回调（这是功能，不是密钥）

**注意事项**：
- ⚠️ API v2密钥非常重要，请妥善保管，不要泄露
- ⚠️ 如果忘记密钥，需要重新设置
- ⚠️ 设置密钥后，旧的密钥会立即失效
- ⚠️ 不要和API v3密钥混淆（API v3密钥在"API v3密钥"选项卡）

---

#### 1.3.3 获取 AppID（可选）

**说明**：
- 如果使用 **H5支付**（网页支付），**不需要 AppID**
- 如果使用 **JSAPI支付**（公众号支付），需要公众号的 AppID

**H5支付（推荐）**：
- ✅ 不需要 AppID
- ✅ 用户无需关注公众号
- ✅ 适合网页直接支付

**JSAPI支付（需要 AppID）**：
- 需要先注册微信公众平台（https://mp.weixin.qq.com/）
- 在公众号后台获取 AppID
- 位置：公众号后台 → 开发 → 基本配置 → AppID

**建议**：
- 对于网页支付，推荐使用 **H5支付**，不需要 AppID
- 如果确实需要公众号支付，再申请公众号并获取 AppID

---

#### 1.3.4 下载证书文件（可选）

**说明**：
- 证书文件用于退款、查询订单等高级功能
- 如果只需要支付功能，**不需要证书**
- 证书文件包括：
  - `apiclient_cert.pem`（证书文件）
  - `apiclient_key.pem`（私钥文件）

**获取步骤**（如果需要）：
1. 登录商户平台
2. 账户中心 → API安全 → API证书
3. 点击"下载证书"
4. 输入商户号和密码确认
5. 下载证书压缩包
6. 解压后得到证书文件

**注意事项**：
- 证书文件需要妥善保管
- 证书有有效期，过期需要重新下载
- 对于基础支付功能，可以暂时不下载证书

### 1.4 费率

- **一般行业**：0.6%
- **教育行业**：可能有优惠（需咨询）

---

## 二、申请支付宝商户号

### 2.1 申请入口

**官网**：https://b.alipay.com/

### 2.2 申请步骤

1. **注册账号**
   - 访问支付宝开放平台
   - 使用支付宝账号登录
   - 选择"企业入驻"

2. **选择主体类型**
   - 选择"个体工商户"
   - 填写营业执照信息

3. **填写资料**
   - 营业执照信息
   - 法人信息
   - 结算账户信息
   - 联系人信息

4. **上传资料**
   - 营业执照照片
   - 法人身份证正反面
   - 结算账户证明

5. **等待审核**
   - 审核时间：1-3 个工作日
   - 审核通过后，会收到支付宝商户号

### 2.3 获取配置信息

审核通过后，登录支付宝开放平台（https://open.alipay.com/），按以下步骤获取配置信息：

#### 2.3.1 创建应用并获取 AppID

**步骤**：
1. 登录支付宝开放平台
2. 进入"控制台"
3. 点击"网页&移动应用" → "创建应用"
4. 选择应用类型：**"手机网站支付"**（推荐）
5. 填写应用信息：
   - 应用名称：例如"论文格式修复服务"
   - 应用图标：上传应用图标
   - 应用描述：填写应用描述
6. 提交审核（通常很快通过）
7. 审核通过后，在应用列表中可以看到 **AppID**
8. **复制保存**这个 AppID，这就是 `ALIPAY_APP_ID`

**示例**：
```
AppID：2021001234567890
```

---

#### 2.3.2 生成密钥对

**步骤**：
1. 在应用详情页面，找到"开发信息"
2. 点击"设置"或"查看"应用公钥
3. 下载支付宝密钥生成工具（RSA密钥生成工具）
   - 工具下载地址：在开放平台页面有提供
   - 或使用在线工具：https://opendocs.alipay.com/common/02kkv7
4. 使用工具生成密钥对：
   - 密钥长度：选择 **2048位**
   - 密钥格式：选择 **PKCS8**
   - 点击"生成密钥"
5. 会生成两个密钥：
   - **应用私钥**（private_key）：这是 `ALIPAY_PRIVATE_KEY`
   - **应用公钥**（public_key）：需要上传到支付宝

**重要**：
- ⚠️ 应用私钥非常重要，请妥善保管，不要泄露
- ⚠️ 私钥只显示一次，请立即复制保存
- ⚠️ 建议保存到安全的地方

---

#### 2.3.3 上传应用公钥并获取支付宝公钥

**步骤**：
1. 在应用详情页面的"开发信息"中
2. 找到"接口加签方式" → "设置"
3. 选择"公钥"方式
4. 将刚才生成的 **应用公钥** 粘贴进去
5. 点击"保存"
6. 保存后，支付宝会生成 **支付宝公钥**
7. **复制保存**这个支付宝公钥，这就是 `ALIPAY_PUBLIC_KEY`

**示例格式**：
```
支付宝公钥（很长的一串字符）：
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
```

---

#### 2.3.4 获取商户号（partner_id）

**位置**：开放平台控制台

**步骤**：
1. 登录支付宝开放平台
2. 在控制台首页可以看到"商户号"或"PID"
3. **复制保存**这个商户号，这就是 `ALIPAY_PARTNER_ID`

**注意**：
- 有些新版本的支付宝可能不显示 partner_id
- 如果找不到，可以联系支付宝客服获取
- 或者在某些接口文档中，partner_id 可能已经不再使用（新版本主要使用 app_id）

---

#### 2.3.5 配置信息总结

获取到以下信息后，就可以配置环境变量了：

| 配置项 | 环境变量名 | 获取位置 |
|--------|-----------|---------|
| 应用ID | `ALIPAY_APP_ID` | 应用详情页 |
| 商户号 | `ALIPAY_PARTNER_ID` | 控制台首页（可选，新版本可能不需要） |
| 应用私钥 | `ALIPAY_PRIVATE_KEY` | 密钥生成工具生成 |
| 支付宝公钥 | `ALIPAY_PUBLIC_KEY` | 上传应用公钥后获取 |
| 网关地址 | `ALIPAY_GATEWAY` | 固定值：`https://openapi.alipay.com/gateway.do` |
| 签名类型 | `ALIPAY_SIGN_TYPE` | 固定值：`RSA2` |

### 2.4 费率

- **一般行业**：0.6%
- **教育行业**：可能有优惠（需咨询）

---

## 三、配置环境变量

在 Vercel 项目设置中添加以下环境变量：

### 3.1 微信支付配置

```
# 微信支付商户号
WECHAT_MCH_ID=你的商户号

# 微信支付API密钥
WECHAT_API_KEY=你的API密钥

# 微信支付AppID（如果使用公众号支付）
WECHAT_APP_ID=你的AppID（可选）

# 微信支付证书路径（退款等高级功能需要，可选）
WECHAT_CERT_PATH=/tmp/cert/apiclient_cert.pem
WECHAT_KEY_PATH=/tmp/cert/apiclient_key.pem
```

### 3.2 支付宝配置

```
# 支付宝应用ID
ALIPAY_APP_ID=你的应用ID

# 支付宝商户号
ALIPAY_PARTNER_ID=你的商户号

# 支付宝应用私钥
ALIPAY_PRIVATE_KEY=你的应用私钥

# 支付宝公钥
ALIPAY_PUBLIC_KEY=支付宝公钥

# 支付宝网关（生产环境）
ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do

# 支付宝签名类型
ALIPAY_SIGN_TYPE=RSA2
```

### 3.3 通用配置

```
# 支付价格（元）
PAYMENT_PRICE=9.9

# 网站基础URL（用于支付回调）
BASE_URL=https://geshixiugai.org
```

---

## 四、支付方式选择

### 4.1 微信支付

**推荐方式**：H5支付（网页支付）

- ✅ 用户无需关注公众号
- ✅ 适合PC和移动端
- ✅ 接入简单

**其他方式**：
- JSAPI支付（需要公众号）
- Native支付（扫码支付）
- 小程序支付（需要小程序）

### 4.2 支付宝

**推荐方式**：手机网站支付

- ✅ 适合PC和移动端
- ✅ 用户体验好
- ✅ 接入简单

**其他方式**：
- 电脑网站支付（PC端）
- 当面付（线下场景）

---

## 五、申请时间线

1. **准备资料**：1-2 天
   - 营业执照
   - 法人身份证
   - 银行卡信息

2. **提交申请**：30 分钟
   - 填写资料
   - 上传证件

3. **等待审核**：1-3 个工作日
   - 微信支付：通常 1-2 天
   - 支付宝：通常 1-3 天

4. **配置开发**：1-2 天
   - 获取配置信息
   - 集成到系统
   - 测试支付流程

**总计**：约 1 周时间

---

## 六、注意事项

### 6.1 营业执照

- 确保营业执照在有效期内
- 经营范围要包含相关业务（如：技术服务、软件开发等）

### 6.2 结算账户

- 必须是法人名下的银行卡
- 建议使用对公账户（个体工商户也可以使用法人个人账户）

### 6.3 网站备案

- 如果使用国内服务器，需要网站备案
- 如果使用 Vercel（海外），通常不需要备案

### 6.4 费率说明

- 微信支付：0.6%（一般行业）
- 支付宝：0.6%（一般行业）
- 具体费率以申请时为准

### 6.5 提现规则

- **微信支付**：T+1 到账（第二天到账）
- **支付宝**：T+1 到账（第二天到账）
- 有最低提现金额限制（通常 1 元）

---

## 七、常见问题

### Q1: 个体工商户可以申请吗？

**A**: 可以！个体工商户可以申请微信支付和支付宝商户号。

### Q2: 需要网站备案吗？

**A**: 
- 如果使用国内服务器，需要备案
- 如果使用 Vercel（海外），通常不需要备案
- 建议咨询支付平台客服确认

### Q3: 审核不通过怎么办？

**A**: 
- 检查资料是否完整
- 检查营业执照是否有效
- 联系客服咨询具体原因

### Q4: 可以只申请一个吗？

**A**: 可以。可以只申请微信支付或只申请支付宝，也可以两个都申请。

### Q5: 费率可以谈吗？

**A**: 
- 一般行业：0.6%（固定）
- 特殊行业（如教育）：可能有优惠，需咨询客服

---

## 八、下一步

申请完成后，我可以帮你：

1. ✅ 集成微信支付官方接口
2. ✅ 集成支付宝官方接口
3. ✅ 更新前端支付逻辑
4. ✅ 测试支付流程
5. ✅ 配置支付回调

**准备好配置信息后，告诉我即可开始集成！**



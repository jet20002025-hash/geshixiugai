# æ”¯ä»˜å®é…ç½®æœªåŠ è½½ - æ’æŸ¥ä¿®å¤

## ğŸ” é—®é¢˜

è°ƒè¯•ç«¯ç‚¹æ˜¾ç¤ºæ”¯ä»˜å®é…ç½®éƒ½æ˜¯ `false`ï¼Œè¯´æ˜ç¯å¢ƒå˜é‡æ²¡æœ‰æ­£ç¡®åŠ è½½ã€‚

---

## ğŸš€ æ’æŸ¥æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```bash
cd /var/www/geshixiugai
ls -la .env
```

### æ­¥éª¤ 2ï¼šæ£€æŸ¥ .env æ–‡ä»¶å†…å®¹ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰

```bash
# åªæ˜¾ç¤ºé…ç½®é¡¹åç§°ï¼Œéšè—å€¼
grep "^ALIPAY" .env | sed 's/=.*/=***/'
```

### æ­¥éª¤ 3ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™

```bash
ls -la .env
```

åº”è¯¥æ˜¾ç¤ºï¼š`-rw------- 1 nginx nginx`ï¼ˆæƒé™ 600ï¼Œæ‰€æœ‰è€… nginxï¼‰

### æ­¥éª¤ 4ï¼šæ£€æŸ¥æœåŠ¡æ˜¯å¦è¯»å–äº† .env æ–‡ä»¶

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo tail -n 100 /var/log/geshixiugai/error.log | grep -i -E "(alipay|env|\.env)"
```

---

## ğŸ”§ ä¿®å¤æ­¥éª¤

### æ–¹æ³• 1ï¼šä¿®å¤æ–‡ä»¶æƒé™å¹¶é‡å¯æœåŠ¡

```bash
# 1. ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®
sudo chown nginx:nginx /var/www/geshixiugai/.env
sudo chmod 600 /var/www/geshixiugai/.env

# 2. é‡å¯æœåŠ¡
sudo systemctl restart geshixiugai

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai
```

### æ–¹æ³• 2ï¼šæ£€æŸ¥ .env æ–‡ä»¶æ ¼å¼

ç¡®ä¿ .env æ–‡ä»¶ä¸­çš„é…ç½®æ ¼å¼æ­£ç¡®ï¼š

```bash
# æŸ¥çœ‹ .env æ–‡ä»¶ï¼ˆæ³¨æ„ï¼šä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯ï¼‰
cd /var/www/geshixiugai
cat .env | grep ALIPAY
```

ç¡®ä¿ï¼š
- æ¯è¡Œä¸€ä¸ªé…ç½®é¡¹
- æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼
- å€¼æ²¡æœ‰ç”¨å¼•å·åŒ…è£¹ï¼ˆé™¤éå€¼æœ¬èº«åŒ…å«ç©ºæ ¼ï¼‰
- ç§é’¥å’Œå…¬é’¥å¦‚æœæ˜¯å¤šè¡Œçš„ï¼Œéœ€è¦æ­£ç¡®å¤„ç†

### æ–¹æ³• 3ï¼šæ£€æŸ¥ Python æ˜¯å¦åŠ è½½äº† .env æ–‡ä»¶

æŸ¥çœ‹ä»£ç ä¸­æ˜¯å¦æ­£ç¡®åŠ è½½äº† .env æ–‡ä»¶ï¼š

```bash
# æ£€æŸ¥ main.py ä¸­æ˜¯å¦åŠ è½½äº† .env
grep -n "load_dotenv\|\.env" /var/www/geshixiugai/backend/app/main.py
```

---

## ğŸ“‹ å®Œæ•´æ’æŸ¥å‘½ä»¤

```bash
# 1. æ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦å­˜åœ¨
cd /var/www/geshixiugai
ls -la .env

# 2. æ£€æŸ¥é…ç½®é¡¹ï¼ˆéšè—å€¼ï¼‰
grep "^ALIPAY" .env | sed 's/=.*/=***/'

# 3. æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la .env

# 4. ä¿®å¤æƒé™
sudo chown nginx:nginx /var/www/geshixiugai/.env
sudo chmod 600 /var/www/geshixiugai/.env

# 5. é‡å¯æœåŠ¡
sudo systemctl restart geshixiugai

# 6. æŸ¥çœ‹æ—¥å¿—
sudo tail -n 50 /var/log/geshixiugai/error.log | grep -i alipay
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼š.env æ–‡ä»¶ä¸å­˜åœ¨

å¦‚æœ `.env` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»ºï¼š

```bash
cd /var/www/geshixiugai
vi .env
# æ·»åŠ æ”¯ä»˜å®é…ç½®ï¼Œä¿å­˜é€€å‡º
```

### é—®é¢˜ 2ï¼š.env æ–‡ä»¶æ ¼å¼é”™è¯¯

ç¡®ä¿é…ç½®æ ¼å¼æ­£ç¡®ï¼š
- âœ… æ­£ç¡®ï¼š`ALIPAY_APP_ID=2021001234567890`
- âŒ é”™è¯¯ï¼š`ALIPAY_APP_ID = 2021001234567890`ï¼ˆæœ‰å¤šä½™ç©ºæ ¼ï¼‰
- âŒ é”™è¯¯ï¼š`ALIPAY_APP_ID="2021001234567890"`ï¼ˆä¸éœ€è¦å¼•å·ï¼Œé™¤éå€¼åŒ…å«ç©ºæ ¼ï¼‰

### é—®é¢˜ 3ï¼šå¤šè¡Œç§é’¥/å…¬é’¥æ ¼å¼

å¦‚æœç§é’¥æˆ–å…¬é’¥æ˜¯å¤šè¡Œçš„ï¼Œéœ€è¦ï¼š
- ä½¿ç”¨å•å¼•å·åŒ…è£¹æ•´ä¸ªå€¼ï¼Œæˆ–
- ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ `\n` è¡¨ç¤ºæ¢è¡Œ

---

## ğŸ” éªŒè¯ä¿®å¤

ä¿®å¤åï¼Œå†æ¬¡è®¿é—®ï¼š
```
https://geshixiugai.cn/payments/debug/config
```

åº”è¯¥çœ‹åˆ°ï¼š
```json
{
  "alipay": {
    "app_id_exists": true,
    "configured": true
  }
}
```

---

**å…ˆæ‰§è¡Œæ’æŸ¥å‘½ä»¤ï¼Œå‘Šè¯‰æˆ‘ç»“æœï¼** ğŸ”






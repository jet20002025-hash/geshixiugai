# 部署失败排查指南

## 🔍 常见部署失败原因

### 1. 代码语法错误

**检查方法**：
```bash
# 检查 Python 语法
python3 -m py_compile backend/app/services/document_service.py
python3 -m py_compile backend/app/services/thesis_format_standard.py
```

**常见问题**：
- 重复导入模块
- 缺少导入
- 语法错误（缩进、括号等）

### 2. 导入错误

**检查方法**：
```bash
# 检查模块导入
python3 -c "import sys; sys.path.insert(0, 'backend'); from app.services.thesis_format_standard import FONT_STANDARDS; print('OK')"
```

**常见问题**：
- 模块路径错误
- 循环导入
- 缺少依赖包

### 3. 依赖问题

**检查 `requirements.txt`**：
- 确保所有依赖都已列出
- 检查版本号是否正确
- 确保依赖包在 Vercel 上可用

### 4. Vercel 配置问题

**检查 `vercel.json`**：
```json
{
  "functions": {
    "api/index.py": {
      "maxDuration": 30,
      "maxRequestSize": "20mb"
    }
  }
}
```

### 5. 环境变量问题

**检查 Vercel 环境变量**：
- 确保所有必需的环境变量都已设置
- 检查环境变量名称是否正确
- 检查环境变量值是否正确

## 🔧 快速修复步骤

### 步骤 1：检查代码语法

```bash
cd /Users/zwj/word格式修改器
python3 -m py_compile backend/app/services/*.py
```

### 步骤 2：检查导入

```bash
# 检查主要模块
python3 -c "
import sys
sys.path.insert(0, 'backend')
try:
    from app.services.thesis_format_standard import FONT_STANDARDS
    print('✅ thesis_format_standard 导入成功')
except Exception as e:
    print(f'❌ 导入失败: {e}')
"
```

### 步骤 3：检查 Vercel 部署日志

1. 登录 Vercel Dashboard
2. 进入项目 → Deployments
3. 查看最新部署的构建日志
4. 查找错误信息

### 步骤 4：本地测试

```bash
# 安装依赖
pip install -r requirements.txt

# 测试导入
python3 -c "
import sys
sys.path.insert(0, 'backend')
from app.main import create_app
app = create_app()
print('✅ 应用创建成功')
"
```

## 🐛 常见错误及解决方案

### 错误 1：ModuleNotFoundError

**原因**：缺少依赖包或导入路径错误

**解决方案**：
1. 检查 `requirements.txt` 是否包含所有依赖
2. 检查导入路径是否正确
3. 确保在 Vercel 上安装了所有依赖

### 错误 2：SyntaxError

**原因**：代码语法错误

**解决方案**：
1. 检查缩进是否正确
2. 检查括号是否匹配
3. 检查是否有重复导入

### 错误 3：ImportError

**原因**：模块导入失败

**解决方案**：
1. 检查模块文件是否存在
2. 检查 `__init__.py` 文件是否正确
3. 检查相对导入路径是否正确

### 错误 4：AttributeError

**原因**：对象属性不存在

**解决方案**：
1. 检查对象类型是否正确
2. 检查方法调用是否正确
3. 检查属性名称是否正确

## 📋 部署前检查清单

- [ ] 代码语法检查通过
- [ ] 所有模块导入成功
- [ ] `requirements.txt` 包含所有依赖
- [ ] `vercel.json` 配置正确
- [ ] 环境变量已设置
- [ ] 本地测试通过

## 🚀 重新部署

如果修复了问题，重新部署：

```bash
# 提交修复
git add .
git commit -m "fix: 修复部署问题"
git push origin main

# Vercel 会自动重新部署
# 或在 Vercel Dashboard 中手动触发部署
```

## 📞 获取详细错误信息

如果仍然失败，请：

1. **查看 Vercel 构建日志**
   - 登录 Vercel Dashboard
   - 进入项目 → Deployments
   - 点击失败的部署
   - 查看 "Build Logs"

2. **检查错误信息**
   - 复制完整的错误信息
   - 查找错误堆栈
   - 定位问题代码

3. **提供错误信息**
   - 错误类型（SyntaxError、ImportError 等）
   - 错误位置（文件名和行号）
   - 完整错误堆栈

---

**如果遇到具体错误，请提供 Vercel 构建日志中的错误信息！**


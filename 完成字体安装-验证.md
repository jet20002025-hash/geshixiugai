# 完成中文字体安装和验证

## 已完成的步骤
✅ 字体文件已下载到 `/usr/share/fonts/chinese/wqy-microhei.ttc`

## 下一步操作

### 1. 更新字体缓存
```bash
sudo fc-cache -fv
```

### 2. 验证字体安装
```bash
# 检查中文字体是否可用
fc-list :lang=zh | grep -i wqy

# 或者查看所有中文字体
fc-list :lang=zh
```

### 3. 设置字体文件权限（如果需要）
```bash
sudo chmod 644 /usr/share/fonts/chinese/wqy-microhei.ttc
sudo chown root:root /usr/share/fonts/chinese/wqy-microhei.ttc
```

### 4. 重启服务
```bash
sudo systemctl restart geshixiugai
```

### 5. 测试中文字符显示
重新上传一个包含中文的文档，然后查看日志：

```bash
# 查看PDF生成日志，关注中文字符诊断信息
sudo journalctl -u geshixiugai -f | grep -E "\[PDF预览\].*中文|字体|PDF中的中文字符"
```

## 预期结果

如果安装成功，日志应该显示：
- `✅ HTML中包含中文字符`
- `✅ PDF中包含中文字符，字体支持正常`
- `PDF中的中文字符数: XXX 字符`（大于0）

如果仍然显示 `PDF中的中文字符数: 0`，可能需要：
1. 检查 WeasyPrint 是否能找到字体
2. 尝试安装更多字体（如宋体、黑体）
3. 检查字体文件格式是否正确





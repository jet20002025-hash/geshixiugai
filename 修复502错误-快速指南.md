# 502 Bad Gateway é”™è¯¯å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸ” é—®é¢˜è¯Šæ–­

502 Bad Gateway é€šå¸¸è¡¨ç¤ºåç«¯æœåŠ¡ï¼ˆGunicornï¼‰æ²¡æœ‰æ­£å¸¸è¿è¡Œã€‚

## ğŸš€ å¿«é€Ÿä¿®å¤æ­¥éª¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰

### æ­¥éª¤ 1: æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
sudo systemctl status geshixiugai
```

**å¦‚æœæ˜¾ç¤º `inactive` æˆ– `failed`**ï¼Œç»§ç»­ä¸‹ä¸€æ­¥ã€‚

### æ­¥éª¤ 2: æŸ¥çœ‹é”™è¯¯æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯æ—¥å¿—ï¼ˆæœ€å 50 è¡Œï¼‰
sudo journalctl -u geshixiugai -n 50 --no-pager
```

**è¯·å°†é”™è¯¯æ—¥å¿—å‘ç»™æˆ‘ï¼Œä»¥ä¾¿å‡†ç¡®è¯Šæ–­é—®é¢˜ã€‚**

### æ­¥éª¤ 3: æ£€æŸ¥ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

```bash
cd /var/www/geshixiugai

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æµ‹è¯•åº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸å¯¼å…¥
python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')" 2>&1
```

**å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œä¼šæ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯ã€‚**

### æ­¥éª¤ 4: æ›´æ–°ä»£ç ï¼ˆå¦‚æœå¯¼å…¥å¤±è´¥ï¼‰

```bash
cd /var/www/geshixiugai

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°å®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### æ­¥éª¤ 5: é‡å¯æœåŠ¡

```bash
# é‡å¯æœåŠ¡
sudo systemctl restart geshixiugai

# ç­‰å¾… 3 ç§’
sleep 3

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai
```

**åº”è¯¥æ˜¾ç¤º `active (running)`**

### æ­¥éª¤ 6: æ£€æŸ¥ç«¯å£ç›‘å¬

```bash
# æ£€æŸ¥ 8000 ç«¯å£æ˜¯å¦è¢«ç›‘å¬
sudo netstat -tlnp | grep 8000

# æˆ–è€…
sudo ss -tlnp | grep 8000
```

**åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š**
```
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      12345/gunicorn
```

### æ­¥éª¤ 7: æµ‹è¯•æœ¬åœ°è®¿é—®

```bash
# æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://localhost:8000

# åº”è¯¥è¿”å› JSON æˆ–é‡å®šå‘å“åº”
```

### æ­¥éª¤ 8: æ£€æŸ¥ Nginx é…ç½®

```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥ Nginx é…ç½®è¯­æ³•
sudo nginx -t

# å¦‚æœé…ç½®æœ‰é—®é¢˜ï¼Œé‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ğŸ”§ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: ModuleNotFoundError

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º `ModuleNotFoundError: No module named 'xxx'`

**è§£å†³**:
```bash
cd /var/www/geshixiugai
source venv/bin/activate
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
sudo systemctl restart geshixiugai
```

### é”™è¯¯ 2: ImportError æˆ–è¯­æ³•é”™è¯¯

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º `ImportError` æˆ– `SyntaxError`

**è§£å†³**:
```bash
cd /var/www/geshixiugai
git pull origin main
source venv/bin/activate
python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')" 2>&1
```

å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œè¯·å°†é”™è¯¯ä¿¡æ¯å‘ç»™æˆ‘ã€‚

### é”™è¯¯ 3: ç«¯å£è¢«å ç”¨

**ç—‡çŠ¶**: æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæ—¥å¿—æ˜¾ç¤ºç«¯å£è¢«å ç”¨

**è§£å†³**:
```bash
# æŸ¥æ‰¾å ç”¨ 8000 ç«¯å£çš„è¿›ç¨‹
sudo lsof -i :8000

# æˆ–è€…
sudo netstat -tlnp | grep 8000

# å¦‚æœå‘ç°å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œå¯ä»¥ï¼š
# 1. åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
# 2. æˆ–è€…ä¿®æ”¹ gunicorn_config.py ä¸­çš„ç«¯å£å·
```

### é”™è¯¯ 4: æƒé™é—®é¢˜

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º `Permission denied`

**è§£å†³**:
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/geshixiugai

# ç¡®ä¿æœåŠ¡ç”¨æˆ·æœ‰æƒé™è®¿é—®
sudo chown -R nginx:nginx /var/www/geshixiugai
```

---

## ğŸ“‹ å®Œæ•´ä¿®å¤æµç¨‹ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/geshixiugai

# 2. æ›´æ–°ä»£ç 
git pull origin main

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# 4. æµ‹è¯•åº”ç”¨å¯¼å…¥
python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')" 2>&1

# 5. å¦‚æœå¯¼å…¥æˆåŠŸï¼Œé‡å¯æœåŠ¡
sudo systemctl restart geshixiugai

# 6. ç­‰å¾… 3 ç§’
sleep 3

# 7. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai

# 8. æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://localhost:8000

# 9. æŸ¥çœ‹æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
sudo journalctl -u geshixiugai -f
```

---

## âš ï¸ å¦‚æœä»ç„¶å¤±è´¥

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æœåŠ¡çŠ¶æ€**ï¼š
   ```bash
   sudo systemctl status geshixiugai
   ```

2. **é”™è¯¯æ—¥å¿—**ï¼š
   ```bash
   sudo journalctl -u geshixiugai -n 100 --no-pager
   ```

3. **åº”ç”¨å¯¼å…¥æµ‹è¯•ç»“æœ**ï¼š
   ```bash
   cd /var/www/geshixiugai
   source venv/bin/activate
   python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')" 2>&1
   ```

4. **ç«¯å£ç›‘å¬æƒ…å†µ**ï¼š
   ```bash
   sudo netstat -tlnp | grep 8000
   ```

---

## âœ… éªŒè¯ä¿®å¤æˆåŠŸ

ä¿®å¤æˆåŠŸåï¼Œåº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… è®¿é—® https://www.geshixiugai.cn
2. âœ… è®¿é—® https://www.geshixiugai.cn/web/convert.html
3. âœ… æœåŠ¡çŠ¶æ€æ˜¾ç¤º `active (running)`
4. âœ… æœ¬åœ°æµ‹è¯• `curl http://localhost:8000` è¿”å›æ­£å¸¸å“åº”


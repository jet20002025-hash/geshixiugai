# 支付信息显示问题排查

## 问题现象

支付环节没有任何内容显示。

## 排查步骤

### 第一步：检查文档是否处理完成

1. 上传文档后，查看页面是否显示：
   - ✅ 文档 ID
   - ✅ 处理状态
   - ✅ 已付费状态

2. 如果这些信息都没有，说明文档可能还没处理完成，或者 `latestDocumentId` 没有正确设置。

### 第二步：检查浏览器控制台

1. **打开浏览器控制台**
   - 按 `F12` 或右键 → 检查
   - 切换到 **Console**（控制台）标签

2. **上传文档后，查看日志**

   应该看到以下日志：
   ```
   文档上传成功，documentId: [文档ID]
   刷新文档状态，documentId: [文档ID]
   文档详情数据: {...}
   正在加载支付信息，documentId: [文档ID]
   支付信息 API 响应状态: 200
   支付信息数据: {...}
   ```

3. **如果有错误，查看错误信息**

   常见错误：
   - `latestDocumentId 为空` → 文档 ID 没有正确保存
   - `获取支付信息失败: 404` → API 路径错误或文档不存在
   - `获取支付信息失败: 500` → 服务器错误

### 第三步：手动测试支付 API

1. **获取文档 ID**
   - 在页面上找到"文档 ID"
   - 或从浏览器控制台日志中获取

2. **测试 API**
   - 在浏览器地址栏输入：
   ```
   https://geshixiugai-app.vercel.app/payments/info/[你的文档ID]
   ```
   - 应该返回 JSON 格式的支付信息

3. **如果返回 404**
   - 检查文档 ID 是否正确
   - 检查文档是否已处理完成

4. **如果返回 500**
   - 检查服务器日志
   - 可能是存储路径问题

### 第四步：检查支付信息区域

1. **检查 HTML 元素是否存在**
   - 在控制台输入：
   ```javascript
   document.getElementById('paymentInfo')
   document.getElementById('paymentAmount')
   document.getElementById('payButton')
   ```
   - 如果返回 `null`，说明 HTML 元素不存在

2. **检查元素是否被隐藏**
   - 在控制台输入：
   ```javascript
   document.getElementById('paymentInfo').style.display
   ```
   - 如果是 `none`，说明被隐藏了

3. **手动显示支付信息**
   - 在控制台输入：
   ```javascript
   document.getElementById('paymentInfo').style.display = 'block'
   ```

## 常见问题

### 问题1: latestDocumentId 为空

**原因：**
- 文档上传失败
- 文档 ID 没有正确保存

**解决：**
- 检查文档上传是否成功
- 查看控制台是否有错误

### 问题2: API 返回 404

**原因：**
- 文档 ID 错误
- 文档不存在
- API 路径错误

**解决：**
- 检查文档 ID 是否正确
- 确认文档已处理完成
- 检查 API 路径：`/payments/info/{document_id}`

### 问题3: API 返回 500

**原因：**
- 服务器内部错误
- 存储路径问题
- 代码错误

**解决：**
- 查看 Vercel 部署日志
- 检查环境变量配置
- 检查代码是否有错误

### 问题4: 支付信息区域不显示

**原因：**
- 元素被 CSS 隐藏
- JavaScript 没有执行
- API 调用失败但没有显示默认信息

**解决：**
- 检查控制台是否有错误
- 手动显示支付信息区域
- 检查 `showDefaultPaymentInfo` 函数是否被调用

## 快速测试

### 测试1: 检查文档处理

访问：
```
https://geshixiugai-app.vercel.app/documents/[文档ID]
```

应该返回文档详情 JSON。

### 测试2: 检查支付信息 API

访问：
```
https://geshixiugai-app.vercel.app/payments/info/[文档ID]
```

应该返回支付信息 JSON。

### 测试3: 检查前端代码

在浏览器控制台输入：
```javascript
// 检查 latestDocumentId
console.log('latestDocumentId:', latestDocumentId);

// 检查支付信息元素
console.log('paymentInfo:', document.getElementById('paymentInfo'));
console.log('paymentAmount:', document.getElementById('paymentAmount'));

// 手动加载支付信息（如果有文档ID）
if (latestDocumentId) {
  loadPaymentInfo(latestDocumentId, false);
}
```

## 需要帮助？

请提供以下信息：

1. **浏览器控制台的错误信息**
   - 截图或复制错误信息

2. **文档 ID**
   - 从页面上获取或从控制台日志获取

3. **API 测试结果**
   - `/documents/[ID]` 返回什么？
   - `/payments/info/[ID]` 返回什么？

4. **页面显示情况**
   - 是否显示了文档 ID、状态等信息？
   - 支付信息区域是完全空白，还是有其他内容？

有了这些信息，我可以帮你进一步排查问题。


# 查看检测日志命令说明

## 📋 命令作用

```bash
sudo grep "\[检测\]" /var/log/geshixiugai/error.log | tail -n 50
```

这条命令的作用是：
1. **`grep "\[检测\]"`** - 在日志文件中搜索包含 `[检测]` 标记的行
2. **`/var/log/geshixiugai/error.log`** - 搜索的日志文件路径
3. **`tail -n 50`** - 只显示最后50条匹配的结果

**用途：** 查看文档处理过程中的检测信息，特别是：
- 修复后检测：诚信承诺和摘要分页结果
- PDF生成后检测：PDF中诚信承诺和摘要的分页情况

---

## ⚠️ 没有输出的可能原因

### 原因1：日志文件为空或不存在

**检查方法：**
```bash
# 检查日志文件是否存在
sudo ls -lh /var/log/geshixiugai/error.log

# 查看日志文件内容（最后20行）
sudo tail -n 20 /var/log/geshixiugai/error.log
```

**如果文件不存在或为空：**
- 说明服务可能还没有处理过文档
- 或者日志文件还没有创建

---

### 原因2：代码还没有更新

**检查方法：**
```bash
cd /var/www/geshixiugai
git pull origin main

# 检查代码是否包含检测功能
sudo grep "\[检测\]" backend/app/services/document_service.py
```

**如果没有输出：**
- 说明代码还没有更新
- 需要执行 `git pull origin main` 和 `sudo systemctl restart geshixiugai`

---

### 原因3：服务还没有重启

**检查方法：**
```bash
# 检查服务状态
sudo systemctl status geshixiugai

# 检查服务启动时间
sudo systemctl show -p ActiveEnterTimestamp geshixiugai
```

**如果服务启动时间早于代码更新时间：**
- 需要重启服务：`sudo systemctl restart geshixiugai`

---

### 原因4：还没有处理过文档

**检测功能只在处理文档时才会运行**，所以：
- 如果还没有上传过文档，日志中不会有检测信息
- 需要上传一个文档进行测试

---

## 🔍 排查步骤

### 步骤1：检查日志文件

```bash
# 检查日志文件是否存在
sudo ls -lh /var/log/geshixiugai/error.log

# 查看日志文件内容（最后20行）
sudo tail -n 20 /var/log/geshixiugai/error.log

# 查看所有日志（不筛选）
sudo tail -n 50 /var/log/geshixiugai/error.log
```

---

### 步骤2：检查代码是否已更新

```bash
cd /var/www/geshixiugai
git pull origin main

# 检查代码是否包含检测功能
sudo grep -c "\[检测\]" backend/app/services/document_service.py
```

**如果输出是 0：**
- 说明代码还没有更新，需要更新代码

---

### 步骤3：重启服务

```bash
# 重启服务
sudo systemctl restart geshixiugai

# 检查服务状态
sudo systemctl status geshixiugai
```

---

### 步骤4：上传文档测试

1. 访问网站
2. 上传一个包含"诚信承诺"和"摘要"的文档
3. 等待文档处理完成
4. 然后查看检测日志

---

## 📝 其他查看日志的方法

### 方法1：查看所有日志（不筛选）

```bash
# 查看最后50行日志
sudo tail -n 50 /var/log/geshixiugai/error.log

# 查看最后100行日志
sudo tail -n 100 /var/log/geshixiugai/error.log
```

---

### 方法2：实时查看日志

```bash
# 实时查看所有日志
sudo tail -f /var/log/geshixiugai/error.log

# 实时查看检测信息
sudo tail -f /var/log/geshixiugai/error.log | grep "\[检测\]"
```

**使用说明：**
- 执行命令后，日志会实时显示
- 上传文档时，会看到检测信息输出
- 按 `Ctrl+C` 退出实时查看

---

### 方法3：查看修复信息

```bash
# 查看修复信息
sudo grep "\[修复\]" /var/log/geshixiugai/error.log | tail -n 50

# 查看诊断信息
sudo grep "\[诊断\]" /var/log/geshixiugai/error.log | tail -n 50
```

---

### 方法4：查看systemd服务日志

```bash
# 查看服务日志中的检测信息
sudo journalctl -u geshixiugai -n 200 --no-pager | grep "\[检测\]"

# 实时查看服务日志
sudo journalctl -u geshixiugai -f | grep "\[检测\]"
```

---

## 🎯 快速排查命令

```bash
# 1. 检查日志文件
sudo ls -lh /var/log/geshixiugai/error.log

# 2. 查看日志内容
sudo tail -n 20 /var/log/geshixiugai/error.log

# 3. 检查代码是否已更新
cd /var/www/geshixiugai
git pull origin main

# 4. 检查代码是否包含检测功能
sudo grep -c "\[检测\]" backend/app/services/document_service.py

# 5. 重启服务
sudo systemctl restart geshixiugai

# 6. 检查服务状态
sudo systemctl status geshixiugai
```

---

## 📊 预期的检测日志输出

如果一切正常，上传文档后应该看到类似以下输出：

```
[检测] ========== 修复后检测：诚信承诺和摘要分页结果 ==========
[检测] ✅ 修复成功：诚信承诺和摘要已分开在不同页
[检测] 分页符位置: 1 个
[检测]   - 段落 X: abstract_title_page_break_before

[检测] ========== PDF生成后检测：诚信承诺和摘要分页结果 ==========
[检测] PDF总页数: 50
[检测] 第 2 页包含诚信承诺
[检测] 第 3 页包含摘要
[检测] ========== PDF分页结果 ==========
[检测] ✅ PDF中诚信承诺和摘要分开在不同页
[检测] 诚信承诺在第 2 页，摘要在第 3 页
[检测] ========================================
```

---

## ⚠️ 重要提示

**检测日志只在处理文档时才会生成！**

如果没有输出，请按以下顺序排查：
1. ✅ 检查日志文件是否存在
2. ✅ 检查代码是否已更新
3. ✅ 重启服务
4. ✅ 上传文档进行测试
5. ✅ 然后查看检测日志

---

**执行完这些步骤后，再上传一个文档，然后查看检测日志！** 🔧


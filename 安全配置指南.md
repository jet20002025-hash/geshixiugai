# 安全配置指南

## ⚠️ 重要安全提示

**绝对不要将以下敏感信息提交到 GitHub！**

### 敏感信息清单

以下信息必须保密，只能通过环境变量配置：

1. **微信支付配置**
   - `WECHAT_MCH_ID` - 商户号
   - `WECHAT_API_KEY` - API密钥
   - `WECHAT_APP_ID` - AppID（如果有）

2. **支付宝配置**
   - `ALIPAY_APP_ID` - 应用ID
   - `ALIPAY_PARTNER_ID` - 商户号
   - `ALIPAY_PRIVATE_KEY` - 应用私钥
   - `ALIPAY_PUBLIC_KEY` - 支付宝公钥

3. **PayJS 配置**
   - `PAYJS_MCHID` - 商户号
   - `PAYJS_KEY` - 通信密钥

4. **其他敏感信息**
   - `BASE_URL` - 网站地址（可选，但建议保密）
   - 任何包含真实密钥的配置文件

---

## ✅ 安全实践

### 1. 使用环境变量

**✅ 正确做法**：
- 所有敏感信息都通过环境变量配置
- 在 Vercel Dashboard 中配置环境变量
- 代码中只使用 `os.getenv()` 读取环境变量

**❌ 错误做法**：
- 在代码中硬编码密钥
- 在配置文件中写入真实密钥
- 将包含真实密钥的文件提交到 GitHub

### 2. 配置文件管理

**✅ 正确做法**：
- 配置说明文件使用示例值（如：`你的商户号`）
- 真实配置信息只保存在 Vercel 环境变量中
- 使用 `.gitignore` 排除包含真实密钥的文件

**❌ 错误做法**：
- 在配置文件中写入真实密钥
- 将包含真实密钥的配置文件提交到 GitHub
- 在代码注释中写入真实密钥

### 3. 代码检查

在提交代码前，检查：

```bash
# 检查是否包含敏感信息（替换为你的真实值）
grep -r "你的商户号" .  # 检查是否有硬编码的商户号
grep -r "你的API密钥" .  # 检查是否有硬编码的API密钥
grep -r "2021006109680085" .  # 检查是否有硬编码的AppID（替换为你的真实AppID）

# 检查环境变量使用
grep -r "os.getenv" backend/  # 确保使用环境变量

# 检查是否有硬编码的密钥
grep -r "WECHAT_MCH_ID.*=" backend/  # 不应该有硬编码
grep -r "ALIPAY_APP_ID.*=" backend/  # 不应该有硬编码
```

---

## 🔒 如果已经泄漏了敏感信息

### 立即采取的措施

1. **立即修改密钥**
   - 登录微信支付商户平台
   - 账户中心 → API安全 → API密钥
   - 点击"修改"，设置新的API密钥
   - 旧密钥立即失效

2. **检查 GitHub 提交历史**
   - 查看是否有敏感信息被提交
   - 如果已提交，考虑删除包含敏感信息的提交（需要强制推送）

3. **通知相关人员**
   - 如果密钥已泄漏，通知团队成员
   - 检查是否有异常交易

4. **监控账户**
   - 检查微信支付账户是否有异常
   - 查看交易记录
   - 如有异常，立即联系微信支付客服

---

## 📝 当前项目安全检查

### 已检查的文件

✅ **代码文件**：
- `backend/app/services/wechat_pay_service.py` - 使用环境变量，安全
- `backend/app/services/payment_service.py` - 使用环境变量，安全
- `backend/app/api/payments.py` - 使用环境变量，安全

⚠️ **配置文件**：
- `微信支付配置说明.md` - 已更新为示例值，安全
- `.gitignore` - 已添加敏感文件排除规则

### 建议

1. **定期检查**：
   - 定期检查代码中是否有硬编码的密钥
   - 检查配置文件是否包含真实密钥

2. **使用密钥管理工具**（可选）：
   - 考虑使用密钥管理服务
   - 使用加密的配置文件（本地开发时）

3. **代码审查**：
   - 提交代码前进行自我审查
   - 使用工具自动检查敏感信息

---

## 🛡️ 最佳实践总结

1. ✅ **永远不要**在代码中硬编码密钥
2. ✅ **永远不要**将真实密钥提交到 Git
3. ✅ **永远使用**环境变量存储敏感信息
4. ✅ **定期检查**代码和配置文件
5. ✅ **立即修改**已泄漏的密钥

---

## 📚 相关文档

- [微信支付配置说明.md](./微信支付配置说明.md) - 配置步骤（使用示例值）
- [个体工商户支付申请指南.md](./个体工商户支付申请指南.md) - 申请指南

---

**记住：安全第一！保护你的密钥就是保护你的资金！**


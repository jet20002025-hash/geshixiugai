# é…ç½®æ”¯ä»˜å®æ”¯ä»˜ - æœåŠ¡å™¨æ“ä½œ

## ğŸ“‹ éœ€è¦çš„ä¿¡æ¯

åœ¨é…ç½®ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»å‡†å¤‡å¥½ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æ”¯ä»˜å® AppID**ï¼ˆåº”ç”¨IDï¼‰
2. **åº”ç”¨ç§é’¥ï¼ˆPrivate Keyï¼‰**
3. **æ”¯ä»˜å®å…¬é’¥ï¼ˆPublic Keyï¼‰**

å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦å…ˆåœ¨æ”¯ä»˜å®å¼€æ”¾å¹³å°åˆ›å»ºåº”ç”¨ã€‚

---

## ğŸš€ é…ç½®æ­¥éª¤

### æ­¥éª¤ 1ï¼šç¼–è¾‘ .env æ–‡ä»¶

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆé˜¿é‡Œäº‘æ§åˆ¶å°çš„å¯¹è¯æ¡†é‡Œï¼‰ï¼š

```bash
cd /var/www/geshixiugai
vi .env
```

### æ­¥éª¤ 2ï¼šåœ¨ vi ç¼–è¾‘å™¨ä¸­æ·»åŠ æ”¯ä»˜å®é…ç½®

1. **è·³è½¬åˆ°æ–‡ä»¶æœ«å°¾**ï¼šæŒ‰ `G`ï¼ˆå¤§å†™ï¼‰

2. **è¿›å…¥ç¼–è¾‘æ¨¡å¼**ï¼šæŒ‰ `i`

3. **æ·»åŠ æ”¯ä»˜å®é…ç½®**ï¼š

```bash
# æ”¯ä»˜å®æ”¯ä»˜é…ç½®
ALIPAY_APP_ID=ä½ çš„æ”¯ä»˜å®AppID
ALIPAY_PRIVATE_KEY=ä½ çš„åº”ç”¨ç§é’¥ï¼ˆå®Œæ•´å†…å®¹ï¼‰
ALIPAY_PUBLIC_KEY=æ”¯ä»˜å®å…¬é’¥ï¼ˆå®Œæ•´å†…å®¹ï¼‰
ALIPAY_SIGN_TYPE=RSA2
ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do
BASE_URL=https://geshixiugai.cn
```

**é‡è¦æç¤º**ï¼š
- `ALIPAY_PRIVATE_KEY`ï¼šå¦‚æœåŒ…å« `-----BEGIN RSA PRIVATE KEY-----` å’Œ `-----END RSA PRIVATE KEY-----`ï¼Œéœ€è¦å®Œæ•´å¤åˆ¶åŒ…æ‹¬è¿™äº›æ ‡è®°
- `ALIPAY_PUBLIC_KEY`ï¼šæ”¯ä»˜å®å…¬é’¥ï¼Œå¯èƒ½æ²¡æœ‰ BEGIN/END æ ‡è®°ï¼Œç›´æ¥ç²˜è´´å³å¯
- ç§é’¥å’Œå…¬é’¥å†…å®¹è¾ƒé•¿ï¼Œå¤åˆ¶æ—¶è¯·ç¡®ä¿å®Œæ•´å¤åˆ¶ï¼Œä¸è¦é—æ¼ä»»ä½•å­—ç¬¦

4. **ä¿å­˜é€€å‡º**ï¼š
   - æŒ‰ `Esc` é€€å‡ºç¼–è¾‘æ¨¡å¼
   - è¾“å…¥ `:wq`
   - æŒ‰å›è½¦

### æ­¥éª¤ 3ï¼šç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®

```bash
# ç¡®ä¿ .env æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆæœåŠ¡éœ€è¦è¯»å–ï¼‰
sudo chown nginx:nginx /var/www/geshixiugai/.env
sudo chmod 600 /var/www/geshixiugai/.env
```

### æ­¥éª¤ 4ï¼šé‡å¯æœåŠ¡

```bash
sudo systemctl restart geshixiugai
sudo systemctl status geshixiugai
```

### æ­¥éª¤ 5ï¼šæŸ¥çœ‹æ—¥å¿—ç¡®è®¤é…ç½®

```bash
# æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤æ”¯ä»˜å®é…ç½®åŠ è½½æˆåŠŸ
sudo tail -n 50 /var/log/geshixiugai/error.log | grep -i alipay
```

åº”è¯¥çœ‹åˆ°ï¼š`[AlipayService] æ”¯ä»˜å®å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ`

---

## âœ… éªŒè¯é…ç½®

### æ–¹æ³• 1ï¼šè®¿é—®è°ƒè¯•ç«¯ç‚¹

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
https://geshixiugai.cn/payments/debug/config
```

åº”è¯¥è¿”å› JSONï¼ŒåŒ…å«æ”¯ä»˜å®é…ç½®ä¿¡æ¯ï¼š
```json
{
  "alipay": {
    "app_id_exists": true,
    "app_id_preview": "2021****",
    "private_key_exists": true,
    "public_key_exists": true,
    "configured": true
  }
}
```

### æ–¹æ³• 2ï¼šæµ‹è¯•æ”¯ä»˜æµç¨‹

1. è®¿é—®ï¼šhttps://geshixiugai.cn
2. ä¸Šä¼ æ¨¡æ¿å’Œæ–‡æ¡£
3. è¿›å…¥æ”¯ä»˜é¡µé¢
4. é€‰æ‹©"æ”¯ä»˜å®æ”¯ä»˜"
5. ç‚¹å‡»"ç«‹å³æ”¯ä»˜"
6. åº”è¯¥è·³è½¬åˆ°æ”¯ä»˜å®æ”¯ä»˜é¡µé¢

---

## ğŸ“‹ å®Œæ•´æ“ä½œæµç¨‹

### 1. ç¼–è¾‘ .env æ–‡ä»¶

```bash
cd /var/www/geshixiugai
vi .env
# æ·»åŠ æ”¯ä»˜å®é…ç½®ï¼Œä¿å­˜é€€å‡º
```

### 2. è®¾ç½®æ–‡ä»¶æƒé™

```bash
sudo chown nginx:nginx /var/www/geshixiugai/.env
sudo chmod 600 /var/www/geshixiugai/.env
```

### 3. é‡å¯æœåŠ¡

```bash
sudo systemctl restart geshixiugai
sudo systemctl status geshixiugai
```

### 4. éªŒè¯é…ç½®

- è®¿é—®ï¼šhttps://geshixiugai.cn/payments/debug/config
- æµ‹è¯•æ”¯ä»˜æµç¨‹

---

## âš ï¸ é‡è¦æç¤º

### 1. ç§é’¥æ ¼å¼

- å¦‚æœç§é’¥åŒ…å« `-----BEGIN RSA PRIVATE KEY-----` å’Œ `-----END RSA PRIVATE KEY-----`ï¼Œéœ€è¦å®Œæ•´å¤åˆ¶åŒ…æ‹¬è¿™äº›æ ‡è®°
- å¦‚æœç§é’¥æ˜¯çº¯ base64 å­—ç¬¦ä¸²ï¼Œç›´æ¥ç²˜è´´å³å¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¼å¼åŒ–

### 2. å…¬é’¥æ ¼å¼

- æ”¯ä»˜å®å…¬é’¥å¯èƒ½æ²¡æœ‰ BEGIN/END æ ‡è®°ï¼Œç›´æ¥ç²˜è´´å³å¯
- ç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ æ ‡è®°

### 3. å›è°ƒåœ°å€

ç¡®ä¿åœ¨æ”¯ä»˜å®å¼€æ”¾å¹³å°é…ç½®çš„å›è°ƒåœ°å€æ˜¯ï¼š
- **æœåŠ¡å™¨å¼‚æ­¥é€šçŸ¥é¡µé¢è·¯å¾„**ï¼š`https://geshixiugai.cn/payments/alipay/notify`

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ”¯ä»˜è®¢å•åˆ›å»ºå¤±è´¥

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo tail -n 100 /var/log/geshixiugai/error.log | grep -i alipay
```

### é—®é¢˜ 2ï¼šé…ç½®æœªç”Ÿæ•ˆ

```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat /var/www/geshixiugai/.env | grep ALIPAY

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/geshixiugai/.env
```

### é—®é¢˜ 3ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u geshixiugai -n 50 --no-pager
```

---

**ç°åœ¨å¼€å§‹é…ç½®æ”¯ä»˜å®æ”¯ä»˜ï¼** ğŸ’°











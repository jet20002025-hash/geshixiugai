# Cloudflare R2 é…ç½®éªŒè¯æŒ‡å—

## âœ… é…ç½®å·²å®Œæˆ

ä½ å·²ç»å®Œæˆäº†ä»¥ä¸‹é…ç½®ï¼š
- âœ… R2 Bucket å·²åˆ›å»ºï¼ˆ`word-formatter-storage`ï¼‰
- âœ… API Token å·²åˆ›å»º
- âœ… Vercel ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆ5 ä¸ªå˜é‡ï¼‰

---

## ğŸ” éªŒè¯é…ç½®

### æ–¹æ³• 1ï¼šä½¿ç”¨è°ƒè¯•ç«¯ç‚¹ï¼ˆæ¨èï¼‰

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ä»¥ä¸‹ URL æ£€æŸ¥å­˜å‚¨é…ç½®ï¼š

```
https://geshixiugai.org/documents/debug/storage
```

æˆ–è€…ï¼š

```
https://geshixiugai-app.vercel.app/documents/debug/storage
```

### é¢„æœŸè¿”å›ç»“æœ

å¦‚æœé…ç½®æ­£ç¡®ï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š

```json
{
  "storage_available": true,
  "storage_type": "Cloudflare R2",
  "r2": {
    "account_id_exists": true,
    "account_id_preview": "5003936d****",
    "access_key_id_exists": true,
    "access_key_id_preview": "f663cb46****",
    "secret_access_key_exists": true,
    "secret_access_key_length": 64,
    "bucket_name": "word-formatter-storage",
    "endpoint": "https://5003936d05d7bc23217a0fdef979a238.r2.cloudflarestorage.com",
    "configured": true,
    "available": true
  },
  "supabase": {
    "url_exists": false,
    "key_exists": false,
    "bucket_exists": false,
    "bucket_name": "æœªè®¾ç½®",
    "configured": false,
    "available": false
  },
  "b2": {
    "key_id_exists": false,
    "application_key_exists": false,
    "bucket_name": "æœªè®¾ç½®",
    "configured": false,
    "available": false
  },
  "vercel_env": "production"
}
```

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

### å…³é”®æ£€æŸ¥é¡¹

1. **`storage_available`**: åº”è¯¥æ˜¯ `true`
   - âŒ å¦‚æœæ˜¯ `false`ï¼Œè¯´æ˜æ²¡æœ‰å¯ç”¨çš„å­˜å‚¨åç«¯

2. **`storage_type`**: åº”è¯¥æ˜¯ `"Cloudflare R2"`
   - âŒ å¦‚æœæ˜¯ `"None (ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ)"`ï¼Œè¯´æ˜ R2 é…ç½®æœªç”Ÿæ•ˆ

3. **`r2.configured`**: åº”è¯¥æ˜¯ `true`
   - âŒ å¦‚æœæ˜¯ `false`ï¼Œè¯´æ˜ç¯å¢ƒå˜é‡æœªæ­£ç¡®è®¾ç½®

4. **`r2.available`**: åº”è¯¥æ˜¯ `true`
   - âŒ å¦‚æœæ˜¯ `false`ï¼Œè¯´æ˜ R2 å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥

5. **`r2.account_id_exists`**: åº”è¯¥æ˜¯ `true`
   - âŒ å¦‚æœæ˜¯ `false`ï¼Œæ£€æŸ¥ `R2_ACCOUNT_ID` ç¯å¢ƒå˜é‡

6. **`r2.access_key_id_exists`**: åº”è¯¥æ˜¯ `true`
   - âŒ å¦‚æœæ˜¯ `false`ï¼Œæ£€æŸ¥ `R2_ACCESS_KEY_ID` ç¯å¢ƒå˜é‡

7. **`r2.secret_access_key_exists`**: åº”è¯¥æ˜¯ `true`
   - âŒ å¦‚æœæ˜¯ `false`ï¼Œæ£€æŸ¥ `R2_SECRET_ACCESS_KEY` ç¯å¢ƒå˜é‡

8. **`r2.bucket_name`**: åº”è¯¥æ˜¯ `"word-formatter-storage"`
   - âŒ å¦‚æœä¸åŒ¹é…ï¼Œæ£€æŸ¥ `R2_BUCKET_NAME` ç¯å¢ƒå˜é‡

9. **`r2.endpoint`**: åº”è¯¥åŒ…å«ä½ çš„ Account ID
   - âŒ å¦‚æœæ˜¾ç¤º "æœªè®¾ç½®"ï¼Œæ£€æŸ¥ `R2_ENDPOINT` æˆ– `R2_ACCOUNT_ID` ç¯å¢ƒå˜é‡

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1ï¼šç­‰å¾…éƒ¨ç½²å®Œæˆ

1. é…ç½®ç¯å¢ƒå˜é‡åï¼ŒVercel ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²
2. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦ 1-3 åˆ†é’Ÿï¼‰
3. æŸ¥çœ‹ Vercel Dashboard ç¡®è®¤éƒ¨ç½²çŠ¶æ€ä¸º "Ready"

### æ­¥éª¤ 2ï¼šæ£€æŸ¥é…ç½®

è®¿é—®è°ƒè¯•ç«¯ç‚¹ï¼š
```
https://geshixiugai.org/documents/debug/storage
```

ç¡®è®¤ï¼š
- âœ… `storage_available: true`
- âœ… `storage_type: "Cloudflare R2"`
- âœ… `r2.configured: true`
- âœ… `r2.available: true`

### æ­¥éª¤ 3ï¼šæµ‹è¯•æ–‡ä»¶ä¸Šä¼ 

1. è®¿é—®ä½ çš„ç½‘ç«™ï¼šhttps://geshixiugai.org
2. ä¸Šä¼ ä¸€ä¸ªæµ‹è¯•æ–‡æ¡£
3. æ£€æŸ¥æ˜¯å¦æˆåŠŸï¼š
   - âœ… ä¸å†å‡ºç°"æ–‡æ¡£ä¸å­˜åœ¨"é”™è¯¯
   - âœ… æ–‡æ¡£å¤„ç†æˆåŠŸ
   - âœ… åœ¨ Cloudflare R2 Dashboard â†’ `word-formatter-storage` ä¸­èƒ½çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶

---

## âŒ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼š`storage_available: false`

**å¯èƒ½åŸå› **ï¼š
- æ‰€æœ‰å­˜å‚¨åç«¯éƒ½ä¸å¯ç”¨
- ç¯å¢ƒå˜é‡æœªæ­£ç¡®è®¾ç½®

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥è°ƒè¯•ç«¯ç‚¹è¿”å›çš„è¯¦ç»†ä¿¡æ¯
2. ç¡®è®¤ R2 é…ç½®é¡¹éƒ½æ˜¾ç¤ºä¸º `true`
3. æ£€æŸ¥ Vercel ç¯å¢ƒå˜é‡æ˜¯å¦éƒ½å·²è®¾ç½®
4. é‡æ–°éƒ¨ç½²

### é—®é¢˜ 2ï¼š`storage_type: "None (ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ)"`

**å¯èƒ½åŸå› **ï¼š
- R2 é…ç½®ä¸å®Œæ•´
- R2 å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `r2.configured` æ˜¯å¦ä¸º `true`
2. æ£€æŸ¥ `r2.available` æ˜¯å¦ä¸º `true`
3. å¦‚æœ `r2.available: false`ï¼Œæ£€æŸ¥ï¼š
   - Access Key ID å’Œ Secret Access Key æ˜¯å¦æ­£ç¡®
   - Bucket åç§°æ˜¯å¦æ­£ç¡®
   - Endpoint URL æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹ Vercel éƒ¨ç½²æ—¥å¿—ï¼ŒæŸ¥æ‰¾é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 3ï¼š`r2.configured: false`

**å¯èƒ½åŸå› **ï¼š
- `R2_ACCESS_KEY_ID` æˆ– `R2_SECRET_ACCESS_KEY` æœªè®¾ç½®

**è§£å†³æ–¹æ³•**ï¼š
1. åœ¨ Vercel Dashboard â†’ Settings â†’ Environment Variables ä¸­æ£€æŸ¥
2. ç¡®è®¤ä¸¤ä¸ªå˜é‡éƒ½å·²è®¾ç½®ä¸”ä¸ä¸ºç©º
3. ç¡®ä¿æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–æ¢è¡Œç¬¦
4. é‡æ–°éƒ¨ç½²

### é—®é¢˜ 4ï¼š`r2.available: false`ï¼ˆä½† `configured: true`ï¼‰

**å¯èƒ½åŸå› **ï¼š
- Access Key ID æˆ– Secret Access Key é”™è¯¯
- Bucket ä¸å­˜åœ¨æˆ–åç§°é”™è¯¯
- ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
1. åœ¨ Cloudflare R2 Dashboard ç¡®è®¤ Bucket åç§°
2. ç¡®è®¤ API Token çš„ Access Key ID å’Œ Secret Access Key æ­£ç¡®
3. å¦‚æœå‡­æ®ä¸¢å¤±ï¼Œéœ€è¦é‡æ–°åˆ›å»º API Token
4. æ£€æŸ¥ Vercel éƒ¨ç½²æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 5ï¼šæ–‡ä»¶ä¸Šä¼ åä»ç„¶æŠ¥é”™

**å¯èƒ½åŸå› **ï¼š
- å­˜å‚¨é…ç½®æ­£ç¡®ï¼Œä½†æ–‡ä»¶ä¸Šä¼ åˆ° R2 å¤±è´¥
- æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ Vercel éƒ¨ç½²æ—¥å¿—
2. åœ¨ Cloudflare R2 Dashboard æ£€æŸ¥ Bucket ä¸­æ˜¯å¦æœ‰æ–‡ä»¶
3. ç¡®è®¤ API Token æƒé™è®¾ç½®ä¸º "Edit"
4. æ£€æŸ¥ Bucket åç§°æ˜¯å¦æ­£ç¡®

---

## ğŸ“‹ å®Œæ•´éªŒè¯æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼š

- [ ] Vercel éƒ¨ç½²å·²å®Œæˆ
- [ ] è®¿é—®è°ƒè¯•ç«¯ç‚¹ï¼š`https://geshixiugai.org/documents/debug/storage`
- [ ] `storage_available: true`
- [ ] `storage_type: "Cloudflare R2"`
- [ ] `r2.configured: true`
- [ ] `r2.available: true`
- [ ] `r2.account_id_exists: true`
- [ ] `r2.access_key_id_exists: true`
- [ ] `r2.secret_access_key_exists: true`
- [ ] `r2.bucket_name: "word-formatter-storage"`
- [ ] `r2.endpoint` åŒ…å«æ­£ç¡®çš„ Account ID
- [ ] æµ‹è¯•æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
- [ ] åœ¨ R2 Dashboard ä¸­èƒ½çœ‹åˆ°ä¸Šä¼ çš„æ–‡ä»¶

---

## ğŸ¯ ä¸‹ä¸€æ­¥

é…ç½®éªŒè¯å®Œæˆåï¼š

1. âœ… **å¦‚æœæ‰€æœ‰æ£€æŸ¥é¡¹éƒ½é€šè¿‡**ï¼š
   - æ­å–œï¼R2 å­˜å‚¨é…ç½®æˆåŠŸ
   - å¯ä»¥å¼€å§‹æ­£å¸¸ä½¿ç”¨æœåŠ¡äº†

2. âŒ **å¦‚æœé‡åˆ°é—®é¢˜**ï¼š
   - æŸ¥çœ‹ Vercel éƒ¨ç½²æ—¥å¿—
   - æ£€æŸ¥è°ƒè¯•ç«¯ç‚¹è¿”å›çš„è¯¦ç»†ä¿¡æ¯
   - å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä¼šå¸®ä½ æ’æŸ¥

---

## ğŸ’¡ æç¤º

- **è°ƒè¯•ç«¯ç‚¹**ï¼š`/documents/debug/storage` ä¼šæ˜¾ç¤ºæ‰€æœ‰å­˜å‚¨åç«¯çš„é…ç½®çŠ¶æ€
- **éƒ¨ç½²æ—¥å¿—**ï¼šåœ¨ Vercel Dashboard â†’ Deployments â†’ é€‰æ‹©éƒ¨ç½² â†’ Logs ä¸­æŸ¥çœ‹
- **R2 Dashboard**ï¼šhttps://dash.cloudflare.com â†’ R2 â†’ æŸ¥çœ‹å­˜å‚¨æ¡¶å’Œæ–‡ä»¶

**ç°åœ¨è®¿é—®è°ƒè¯•ç«¯ç‚¹éªŒè¯é…ç½®å§ï¼** ğŸš€


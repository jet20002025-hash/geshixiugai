# 格式标准更新说明

## 📋 更新内容

基于毕业论文格式规范文档，已将格式标准集成到系统中。

## ✅ 已完成的功能

### 1. 创建格式标准配置文件

**文件**: `backend/app/services/thesis_format_standard.py`

包含：
- **页面设置标准**：A4纸，页边距（上3cm、下2cm、左3cm、右2cm），装订线1cm
- **页眉页脚标准**：页眉文本、字体、字号、对齐方式
- **字体字号标准**：各级标题、正文、摘要、关键词、图题、表题、参考文献等格式
- **样式映射规则**：根据段落内容自动识别样式
- **参考文献要求**：最少10篇，外文不少于2篇，期刊论文不少于4篇

### 2. 修改文档处理服务

**文件**: `backend/app/services/document_service.py`

新增功能：
- **`_apply_page_settings()`**: 自动应用页面设置（页边距、装订线等）
- **`_apply_header_footer()`**: 自动应用页眉页脚设置
- **`_merge_rules_with_standard()`**: 合并模板规则和标准规则（标准优先）
- **`_detect_paragraph_style()`**: 根据段落内容自动检测样式

### 3. 格式优先级

**优先级规则**：
1. **毕业论文格式标准**（最高优先级）
2. **用户上传的模板格式**（如果标准中没有对应样式，保留模板格式）
3. **默认格式**（如果都没有，使用标准默认格式）

**冲突处理**：
- 如果模板格式与标准格式冲突，**以标准格式为准**
- 如果模板中有标准中没有的样式，**保留模板样式**

## 🎯 格式标准详情

### 页面设置
- 纸张：A4
- 页边距：上3cm、下2cm、左3cm、右2cm
- 装订线：1cm
- 页眉距边界：2cm
- 页脚距边界：1cm

### 字体字号标准

| 元素 | 字体 | 字号 | 加粗 | 对齐 | 行距 |
|------|------|------|------|------|------|
| 一级标题 | 黑体 | 三号(16pt) | 是 | 居中 | 单倍 |
| 二级标题 | 黑体 | 四号(14pt) | 是 | 左对齐 | - |
| 三级标题 | 黑体 | 小四号(12pt) | 是 | 左对齐 | - |
| 正文 | 宋体 | 小四号(12pt) | 否 | 左对齐 | 20磅 |
| 摘要标题 | 黑体 | 三号(16pt) | 是 | 居中 | - |
| 摘要内容 | 宋体 | 小四号(12pt) | 否 | 左对齐 | 20磅 |
| 关键词 | 黑体/宋体 | 小四号(12pt) | 是/否 | 左对齐 | 20磅 |
| 图题 | 宋体 | 五号(10.5pt) | 否 | 居中 | - |
| 表题 | 宋体 | 五号(10.5pt) | 否 | 居中 | - |
| 参考文献 | 宋体 | 小四号(12pt) | 否 | 左对齐 | 20磅 |

### 自动样式识别

系统会根据段落内容自动识别样式：

- **章节标题**：`第X章`、`Chapter X` → 一级标题
- **小节标题**：`X.X`、`第X节` → 二级标题
- **三级标题**：`X.X.X` → 三级标题
- **图题**：`图X-X` → 图题格式
- **表题**：`表X-X` → 表题格式
- **摘要**：`摘要`、`ABSTRACT` → 摘要标题
- **关键词**：`关键词`、`Keywords` → 关键词格式
- **正文**：其他内容 → 正文格式

## 🔄 工作流程

1. **用户上传文档**
2. **系统加载文档**
3. **应用页面设置**（页边距、装订线等）
4. **应用页眉页脚**（标准页眉）
5. **合并格式规则**（标准 + 模板）
6. **检测段落样式**（根据内容自动识别）
7. **应用格式规则**（标准优先）
8. **生成修正后的文档**

## 📝 使用说明

### 对于用户

1. **上传模板**（可选）：
   - 如果上传了模板，系统会保留模板中的格式
   - 但如果与标准格式冲突，会以标准格式为准

2. **上传论文**：
   - 系统会自动应用格式标准
   - 自动修正页边距、页眉页脚、字体字号等
   - 根据内容自动识别并应用正确的样式

### 对于开发者

1. **修改格式标准**：
   - 编辑 `backend/app/services/thesis_format_standard.py`
   - 修改 `FONT_STANDARDS`、`PAGE_SETTINGS` 等配置

2. **添加新样式**：
   - 在 `FONT_STANDARDS` 中添加新样式
   - 在 `STYLE_MAPPING_RULES` 中添加识别规则

## ⚠️ 注意事项

1. **标准优先**：如果模板格式与标准格式冲突，以标准格式为准
2. **保留兼容**：如果模板中有标准中没有的样式，会保留模板样式
3. **自动识别**：系统会根据段落内容自动识别样式，但可能不完全准确
4. **手动调整**：用户可能需要在修正后手动调整某些特殊格式

## 🚀 下一步

1. **测试格式修正功能**
2. **验证页面设置是否正确应用**
3. **验证页眉页脚是否正确设置**
4. **验证字体字号是否符合标准**
5. **收集用户反馈并优化**

---

**更新日期**: 2025年1月
**版本**: v1.0


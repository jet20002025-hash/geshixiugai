# 502 Bad Gateway é”™è¯¯å¿«é€Ÿä¿®å¤

## ðŸ” é—®é¢˜ï¼š502 Bad Gateway

è¯´æ˜ŽåŽç«¯æœåŠ¡ï¼ˆGunicornï¼‰æ²¡æœ‰æ­£å¸¸è¿è¡Œã€‚

## ðŸš€ å¿«é€Ÿä¿®å¤æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
sudo systemctl status geshixiugai
```

### æ­¥éª¤2: æŸ¥çœ‹é”™è¯¯æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
sudo journalctl -u geshixiugai -n 50 --no-pager

# æˆ–è€…å®žæ—¶æŸ¥çœ‹
sudo journalctl -u geshixiugai -f
```

### æ­¥éª¤3: æ£€æŸ¥ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

```bash
cd /var/www/geshixiugai
source venv/bin/activate

# æµ‹è¯•åº”ç”¨æ˜¯å¦èƒ½æ­£å¸¸å¯¼å…¥
python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')"
```

### æ­¥éª¤4: å¦‚æžœå¯¼å…¥å¤±è´¥ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯

```bash
python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')" 2>&1
```

### æ­¥éª¤5: æ‰‹åŠ¨æµ‹è¯• Gunicorn

```bash
cd /var/www/geshixiugai
source venv/bin/activate

# æ‰‹åŠ¨å¯åŠ¨ Gunicornï¼ˆæµ‹è¯•ç”¨ï¼‰
gunicorn -c gunicorn_config.py backend.app.main:app
```

## ðŸ”§ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: åº”ç”¨å¯¼å…¥å¤±è´¥

**å¯èƒ½åŽŸå› **ï¼š
- ä»£ç æœ‰è¯­æ³•é”™è¯¯
- ç¼ºå°‘ä¾èµ–
- çŽ¯å¢ƒå˜é‡é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ›´æ–°ä»£ç 
git pull origin main

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# æ£€æŸ¥ .env æ–‡ä»¶
cat .env
```

### é—®é¢˜2: æœåŠ¡æ— æ³•å¯åŠ¨

**è§£å†³æ–¹æ³•**ï¼š
```bash
# é‡å¯æœåŠ¡
sudo systemctl restart geshixiugai

# ç­‰å¾…å‡ ç§’åŽæ£€æŸ¥çŠ¶æ€
sleep 3
sudo systemctl status geshixiugai
```

### é—®é¢˜3: ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8000

# æˆ–è€…
sudo lsof -i :8000
```

## ðŸ“‹ å®Œæ•´ä¿®å¤æµç¨‹

```bash
# 1. æ›´æ–°ä»£ç 
cd /var/www/geshixiugai
git pull origin main

# 2. æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒ
source venv/bin/activate

# 3. æµ‹è¯•åº”ç”¨å¯¼å…¥
python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')"

# 4. å¦‚æžœå¯¼å…¥æˆåŠŸï¼Œé‡å¯æœåŠ¡
sudo systemctl restart geshixiugai

# 5. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai

# 6. æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u geshixiugai -n 50 --no-pager
```

## âš ï¸ å¦‚æžœä»ç„¶å¤±è´¥

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æœåŠ¡çŠ¶æ€**ï¼š
```bash
sudo systemctl status geshixiugai
```

2. **é”™è¯¯æ—¥å¿—**ï¼š
```bash
sudo journalctl -u geshixiugai -n 100 --no-pager
```

3. **åº”ç”¨å¯¼å…¥æµ‹è¯•ç»“æžœ**ï¼š
```bash
cd /var/www/geshixiugai
source venv/bin/activate
python -c "from backend.app.main import app; print('âœ… åº”ç”¨å¯¼å…¥æˆåŠŸ')" 2>&1
```





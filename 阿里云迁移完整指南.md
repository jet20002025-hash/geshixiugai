# é˜¿é‡Œäº‘è¿ç§»å®Œæ•´æŒ‡å— - geshixiugai.cn

## ğŸ“‹ è¿ç§»æ¦‚è§ˆ

### å½“å‰çŠ¶æ€
- **å½“å‰åŸŸå**ï¼šgeshixiugai.orgï¼ˆæˆ–ä¹‹å‰çš„åŸŸåï¼‰
- **å½“å‰éƒ¨ç½²**ï¼šVercelï¼ˆServerless Functionsï¼‰
- **å­˜å‚¨æ–¹æ¡ˆ**ï¼šSupabase/R2/B2ï¼ˆäº‘å­˜å‚¨ï¼‰

### ç›®æ ‡çŠ¶æ€
- **æ–°åŸŸå**ï¼šgeshixiugai.cn
- **æ–°æœåŠ¡å™¨**ï¼šé˜¿é‡Œäº‘ ECS
- **å­˜å‚¨æ–¹æ¡ˆ**ï¼šç»§ç»­ä½¿ç”¨ Supabase/R2/B2ï¼ˆæ— éœ€æ”¹å˜ï¼‰
- **å¤‡æ¡ˆè¦æ±‚**ï¼šéœ€è¦å®Œæˆ ICP å¤‡æ¡ˆ

---

## ğŸ¯ è¿ç§»æ­¥éª¤æ€»è§ˆ

```
1. è´­ä¹°é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨
2. è´­ä¹°å¹¶é…ç½®åŸŸå geshixiugai.cn
3. é…ç½®æœåŠ¡å™¨ç¯å¢ƒï¼ˆPythonã€Nginxã€SSLï¼‰
4. éƒ¨ç½²åº”ç”¨ä»£ç 
5. é…ç½®åŸŸåè§£æ
6. æäº¤ ICP å¤‡æ¡ˆ
7. é…ç½®æ”¯ä»˜æ¥å£ï¼ˆæ”¯ä»˜å®/å¾®ä¿¡ï¼‰
8. æµ‹è¯•å’Œä¸Šçº¿
```

---

## æ­¥éª¤ 1ï¼šè´­ä¹°é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨

### 1.1 é€‰æ‹©æœåŠ¡å™¨é…ç½®

**æ¨èé…ç½®**ï¼ˆé€‚åˆåˆæœŸä½¿ç”¨ï¼‰ï¼š
- **CPU**ï¼š2 æ ¸
- **å†…å­˜**ï¼š4 GB
- **ç³»ç»Ÿç›˜**ï¼š40 GB SSD
- **å¸¦å®½**ï¼š5 Mbps
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04 LTSï¼ˆæ¨èï¼‰
- **åœ°åŸŸ**ï¼šé€‰æ‹©ç¦»ä½ è¾ƒè¿‘çš„åœ°åŒºï¼ˆå¦‚ï¼šåä¸œ1-æ­å·ã€åä¸œ2-ä¸Šæµ·ï¼‰

**æœ€ä½é…ç½®**ï¼ˆå¦‚æœé¢„ç®—æœ‰é™ï¼‰ï¼š
- **CPU**ï¼š1 æ ¸
- **å†…å­˜**ï¼š2 GB
- **ç³»ç»Ÿç›˜**ï¼š40 GB SSD
- **å¸¦å®½**ï¼š3 Mbps
- **ä»·æ ¼**ï¼šçº¦ 300-500 å…ƒ/å¹´

### 1.2 è´­ä¹°æ­¥éª¤

1. **ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://ecs.console.aliyun.com/
   - å¦‚æœæ²¡æœ‰è´¦å·ï¼Œå…ˆæ³¨å†Œå¹¶å®Œæˆå®åè®¤è¯

2. **åˆ›å»º ECS å®ä¾‹**
   - ç‚¹å‡»"åˆ›å»ºå®ä¾‹"æˆ–"è´­ä¹°å®ä¾‹"
   - é€‰æ‹©"åŒ…å¹´åŒ…æœˆ"ï¼ˆæ›´ä¾¿å®œï¼‰æˆ–"æŒ‰é‡ä»˜è´¹"ï¼ˆçµæ´»ï¼‰
   - é€‰æ‹©é…ç½®ï¼ˆæŒ‰ä¸Šè¿°æ¨èé…ç½®ï¼‰
   - é€‰æ‹©æ“ä½œç³»ç»Ÿï¼šUbuntu 22.04 LTS
   - è®¾ç½® root å¯†ç ï¼ˆä¿å­˜å¥½ï¼ï¼‰

3. **é…ç½®å®‰å…¨ç»„**
   - å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
     - **80**ï¼šHTTP
     - **443**ï¼šHTTPS
     - **22**ï¼šSSHï¼ˆç”¨äºè¿œç¨‹è¿æ¥ï¼‰
   - å¯é€‰ï¼š8000ï¼ˆå¦‚æœç›´æ¥è®¿é—® APIï¼‰

4. **å®Œæˆè´­ä¹°**
   - ç¡®è®¤é…ç½®å’Œä»·æ ¼
   - å®Œæˆæ”¯ä»˜
   - ç­‰å¾…å®ä¾‹åˆ›å»ºå®Œæˆï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰

### 1.3 è·å–æœåŠ¡å™¨ä¿¡æ¯

è´­ä¹°å®Œæˆåï¼Œè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
- **å…¬ç½‘ IP**ï¼šå¦‚ `123.456.789.012`
- **å®ä¾‹ ID**ï¼šå¦‚ `i-xxxxxxxxxxxxx`
- **root å¯†ç **ï¼šä½ è®¾ç½®çš„å¯†ç 

---

## æ­¥éª¤ 2ï¼šè´­ä¹°å¹¶é…ç½®åŸŸå geshixiugai.cn

### 2.1 è´­ä¹°åŸŸå

1. **ç™»å½•é˜¿é‡Œäº‘åŸŸåæ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://dc.console.aliyun.com/
   - æœç´¢åŸŸåï¼š`geshixiugai.cn`
   - å¦‚æœå¯ç”¨ï¼ŒåŠ å…¥è´­ç‰©è½¦å¹¶è´­ä¹°

2. **å®ŒæˆåŸŸåå®åè®¤è¯**
   - åŸŸåè´­ä¹°åï¼Œéœ€è¦å®åè®¤è¯
   - ä¸Šä¼ èº«ä»½è¯æ­£åé¢ï¼ˆä¸ªäººï¼‰æˆ–è¥ä¸šæ‰§ç…§ï¼ˆä¼ä¸šï¼‰
   - ç­‰å¾…å®¡æ ¸é€šè¿‡ï¼ˆé€šå¸¸ 1-3 ä¸ªå·¥ä½œæ—¥ï¼‰

### 2.2 åŸŸåè§£æé…ç½®ï¼ˆæš‚æ—¶ä¸é…ç½®ï¼Œç­‰æœåŠ¡å™¨éƒ¨ç½²å®Œæˆåå†é…ç½®ï¼‰

**æ³¨æ„**ï¼šåŸŸåè§£ææš‚æ—¶ä¸é…ç½®ï¼Œç­‰æœåŠ¡å™¨éƒ¨ç½²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡åå†é…ç½®ã€‚

---

## æ­¥éª¤ 3ï¼šé…ç½®æœåŠ¡å™¨ç¯å¢ƒ

### 3.1 è¿æ¥åˆ°æœåŠ¡å™¨

ä½¿ç”¨ SSH è¿æ¥åˆ°æœåŠ¡å™¨ï¼š

```bash
ssh root@ä½ çš„å…¬ç½‘IP
# è¾“å…¥ root å¯†ç 
```

### 3.2 æ›´æ–°ç³»ç»Ÿ

```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y git curl wget vim
```

### 3.3 å®‰è£… Python 3.12

```bash
# æ·»åŠ  deadsnakes PPAï¼ˆæä¾› Python 3.12ï¼‰
sudo apt install -y software-properties-common
sudo add-apt-repository ppa:deadsnakes/ppa -y
sudo apt update

# å®‰è£… Python 3.12 å’Œ pip
sudo apt install -y python3.12 python3.12-venv python3.12-dev python3-pip

# éªŒè¯å®‰è£…
python3.12 --version
```

### 3.4 å®‰è£… Nginx

```bash
# å®‰è£… Nginx
sudo apt install -y nginx

# å¯åŠ¨ Nginx
sudo systemctl start nginx
sudo systemctl enable nginx

# éªŒè¯ Nginx è¿è¡ŒçŠ¶æ€
sudo systemctl status nginx
```

### 3.5 å®‰è£…å…¶ä»–ä¾èµ–

```bash
# å®‰è£…ç¼–è¯‘å·¥å…·ï¼ˆæŸäº› Python åŒ…éœ€è¦ï¼‰
sudo apt install -y build-essential libssl-dev libffi-dev
```

---

## æ­¥éª¤ 4ï¼šéƒ¨ç½²åº”ç”¨ä»£ç 

### 4.1 å…‹éš†ä»£ç 

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www
cd /var/www

# å…‹éš†ä»£ç 
sudo git clone https://github.com/jet20002025-hash/geshixiugai.git geshixiugai
cd geshixiugai

# å¦‚æœä»£ç åœ¨ç§æœ‰ä»“åº“ï¼Œéœ€è¦é…ç½® SSH key æˆ–ä½¿ç”¨ token
```

### 4.2 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
cd /var/www/geshixiugai

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.12 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å‡çº§ pip
pip install --upgrade pip
```

### 4.3 å®‰è£… Python ä¾èµ–

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¦‚æœ backend ç›®å½•æœ‰å•ç‹¬çš„ requirements.txt
pip install -r backend/requirements.txt  # å¦‚æœæœ‰çš„è¯
```

### 4.4 é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /var/www/geshixiugai
sudo nano .env
```

æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼ˆæ ¹æ®ä½ ä½¿ç”¨çš„å­˜å‚¨æ–¹æ¡ˆé€‰æ‹©ï¼‰ï¼š

**å¦‚æœä½¿ç”¨ Supabase Storage**ï¼š
```bash
SUPABASE_URL=https://ä½ çš„é¡¹ç›®ID.supabase.co
SUPABASE_KEY=ä½ çš„service_role key
SUPABASE_BUCKET=word-formatter-storage
```

**å¦‚æœä½¿ç”¨ Cloudflare R2**ï¼š
```bash
R2_ACCOUNT_ID=ä½ çš„Account ID
R2_ACCESS_KEY_ID=ä½ çš„Access Key ID
R2_SECRET_ACCESS_KEY=ä½ çš„Secret Access Key
R2_BUCKET_NAME=word-formatter-storage
R2_ENDPOINT=https://ä½ çš„Account ID.r2.cloudflarestorage.com
```

**å¦‚æœä½¿ç”¨ Backblaze B2**ï¼š
```bash
B2_ACCOUNT_ID=ä½ çš„Account ID
B2_APPLICATION_KEY=ä½ çš„Application Key
B2_BUCKET_NAME=word-formatter-storage
B2_ENDPOINT=https://s3.us-west-000.backblazeb2.com
```

**æ”¯ä»˜é…ç½®**ï¼ˆå¦‚æœæœ‰ï¼‰ï¼š
```bash
# æ”¯ä»˜å®
ALIPAY_APP_ID=ä½ çš„æ”¯ä»˜å®AppID
ALIPAY_PRIVATE_KEY=ä½ çš„æ”¯ä»˜å®ç§é’¥
ALIPAY_PUBLIC_KEY=æ”¯ä»˜å®å…¬é’¥

# å¾®ä¿¡æ”¯ä»˜ï¼ˆå¦‚æœæœ‰ï¼‰
WECHAT_APP_ID=ä½ çš„å¾®ä¿¡AppID
WECHAT_MCH_ID=ä½ çš„å•†æˆ·å·
WECHAT_API_KEY=ä½ çš„APIå¯†é’¥
```

ä¿å­˜æ–‡ä»¶ï¼ˆ`Ctrl+O`ï¼Œç„¶å `Enter`ï¼Œæœ€å `Ctrl+X`ï¼‰ã€‚

### 4.5 ä¿®æ”¹ä»£ç ä»¥è¯»å– .env æ–‡ä»¶

æ£€æŸ¥ `backend/app/main.py` æ˜¯å¦å·²é…ç½®è¯»å– `.env` æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦æ·»åŠ ï¼š

```python
from dotenv import load_dotenv
load_dotenv()
```

å¹¶å®‰è£… `python-dotenv`ï¼š
```bash
pip install python-dotenv
```

---

## æ­¥éª¤ 5ï¼šé…ç½® Nginx åå‘ä»£ç†

### 5.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶

```bash
sudo nano /etc/nginx/sites-available/geshixiugai
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name geshixiugai.cn www.geshixiugai.cn;

    # è®¾ç½®è¯·æ±‚ä½“å¤§å°é™åˆ¶ï¼ˆ50MBï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´ï¼‰
    client_max_body_size 50m;

    # å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆç”¨äºå¤§æ–‡ä»¶ä¸Šä¼ ï¼‰
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;

    # æ—¥å¿—
    access_log /var/log/nginx/geshixiugai_access.log;
    error_log /var/log/nginx/geshixiugai_error.log;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket æ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

ä¿å­˜æ–‡ä»¶ã€‚

### 5.2 å¯ç”¨é…ç½®

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/geshixiugai /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx
```

---

## æ­¥éª¤ 6ï¼šé…ç½® Gunicorn å’Œ Systemd æœåŠ¡

### 6.1 å®‰è£… Gunicorn

```bash
cd /var/www/geshixiugai
source venv/bin/activate
pip install gunicorn
```

### 6.2 åˆ›å»º Gunicorn é…ç½®æ–‡ä»¶

```bash
cd /var/www/geshixiugai
nano gunicorn_config.py
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```python
# gunicorn_config.py
import multiprocessing
import os
from pathlib import Path

# å·¥ä½œç›®å½•
chdir = str(Path(__file__).parent)

# ç»‘å®šåœ°å€å’Œç«¯å£
bind = "127.0.0.1:8000"

# Worker æ•°é‡ï¼ˆæ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ï¼‰
workers = multiprocessing.cpu_count() * 2 + 1

# Worker ç±»å‹
worker_class = "uvicorn.workers.UvicornWorker"

# è¶…æ—¶è®¾ç½®
timeout = 120
keepalive = 5

# è¯·æ±‚é™åˆ¶
max_requests = 1000
max_requests_jitter = 50

# æ—¥å¿—
accesslog = "/var/log/geshixiugai/access.log"
errorlog = "/var/log/geshixiugai/error.log"
loglevel = "info"

# è¿›ç¨‹åç§°
proc_name = "geshixiugai"
```

ä¿å­˜æ–‡ä»¶ã€‚

### 6.3 åˆ›å»ºæ—¥å¿—ç›®å½•

```bash
sudo mkdir -p /var/log/geshixiugai
sudo chown www-data:www-data /var/log/geshixiugai
```

### 6.4 åˆ›å»º Systemd æœåŠ¡æ–‡ä»¶

```bash
sudo nano /etc/systemd/system/geshixiugai.service
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Geshixiugai API Service
After=network.target

[Service]
Type=notify
User=www-data
Group=www-data
WorkingDirectory=/var/www/geshixiugai
Environment="PATH=/var/www/geshixiugai/venv/bin"
EnvironmentFile=/var/www/geshixiugai/.env
ExecStart=/var/www/geshixiugai/venv/bin/gunicorn -c gunicorn_config.py backend.app.main:app
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

ä¿å­˜æ–‡ä»¶ã€‚

### 6.5 å¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½ systemd
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start geshixiugai

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable geshixiugai

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u geshixiugai -f
```

---

## æ­¥éª¤ 7ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆHTTPSï¼‰

### 7.1 å®‰è£… Certbot

```bash
sudo apt install -y certbot python3-certbot-nginx
```

### 7.2 é…ç½®åŸŸåè§£æï¼ˆä¸´æ—¶ï¼‰

åœ¨é˜¿é‡Œäº‘åŸŸåæ§åˆ¶å°é…ç½® DNS è§£æï¼š

1. ç™»å½•é˜¿é‡Œäº‘åŸŸåæ§åˆ¶å°ï¼šhttps://dns.console.aliyun.com/
2. æ‰¾åˆ°åŸŸå `geshixiugai.cn`
3. æ·»åŠ  A è®°å½•ï¼š
   - **è®°å½•ç±»å‹**ï¼šA
   - **ä¸»æœºè®°å½•**ï¼š@
   - **è®°å½•å€¼**ï¼šä½ çš„æœåŠ¡å™¨å…¬ç½‘ IP
   - **TTL**ï¼š600
4. æ·»åŠ  A è®°å½•ï¼ˆwwwï¼‰ï¼š
   - **è®°å½•ç±»å‹**ï¼šA
   - **ä¸»æœºè®°å½•**ï¼šwww
   - **è®°å½•å€¼**ï¼šä½ çš„æœåŠ¡å™¨å…¬ç½‘ IP
   - **TTL**ï¼š600

ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰ã€‚

### 7.3 ç”³è¯· SSL è¯ä¹¦

```bash
# ç”³è¯·è¯ä¹¦ï¼ˆä¼šè‡ªåŠ¨é…ç½® Nginxï¼‰
sudo certbot --nginx -d geshixiugai.cn -d www.geshixiugai.cn

# æŒ‰ç…§æç¤ºæ“ä½œï¼š
# 1. è¾“å…¥é‚®ç®±åœ°å€
# 2. åŒæ„æœåŠ¡æ¡æ¬¾
# 3. é€‰æ‹©æ˜¯å¦æ¥æ”¶é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
# 4. ç­‰å¾…éªŒè¯å®Œæˆ
```

### 7.4 è‡ªåŠ¨ç»­æœŸ

Certbot ä¼šè‡ªåŠ¨é…ç½®ç»­æœŸï¼Œä½†å¯ä»¥æ‰‹åŠ¨æµ‹è¯•ï¼š

```bash
# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run
```

---

## æ­¥éª¤ 8ï¼šæµ‹è¯•åº”ç”¨

### 8.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ Gunicorn æœåŠ¡
sudo systemctl status geshixiugai

# æ£€æŸ¥ Nginx æœåŠ¡
sudo systemctl status nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 8000
```

### 8.2 æµ‹è¯•è®¿é—®

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
- `http://ä½ çš„å…¬ç½‘IP`ï¼ˆåº”è¯¥é‡å®šå‘åˆ° HTTPSï¼‰
- `https://geshixiugai.cn`ï¼ˆå¦‚æœåŸŸåå·²è§£æï¼‰
- `https://geshixiugai.cn/web`ï¼ˆå‰ç«¯é¡µé¢ï¼‰
- `https://geshixiugai.cn/docs`ï¼ˆAPI æ–‡æ¡£ï¼‰

### 8.3 æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 

ä¸Šä¼ ä¸€ä¸ªæµ‹è¯•æ–‡æ¡£ï¼Œæ£€æŸ¥ï¼š
- æ–‡ä»¶æ˜¯å¦èƒ½æ­£å¸¸ä¸Šä¼ 
- å­˜å‚¨æ˜¯å¦æ­£å¸¸å·¥ä½œ
- æ–‡æ¡£å¤„ç†æ˜¯å¦æ­£å¸¸

---

## æ­¥éª¤ 9ï¼šæäº¤ ICP å¤‡æ¡ˆ

### 9.1 å¤‡æ¡ˆå‰å‡†å¤‡

ç¡®ä¿ä»¥ä¸‹ä¿¡æ¯å·²å‡†å¤‡å¥½ï¼š
- âœ… åŸŸåå·²å®åè®¤è¯
- âœ… æœåŠ¡å™¨å·²è´­ä¹°
- âœ… ç½‘ç«™å·²éƒ¨ç½²å¹¶èƒ½æ­£å¸¸è®¿é—®
- âœ… èº«ä»½è¯æ­£åé¢ç…§ç‰‡
- âœ… æ‰‹æœºå·ç ï¼ˆéœ€è¦æ¥æ”¶éªŒè¯ç ï¼‰

### 9.2 æäº¤å¤‡æ¡ˆç”³è¯·

1. **ç™»å½•é˜¿é‡Œäº‘å¤‡æ¡ˆç³»ç»Ÿ**
   - è®¿é—®ï¼šhttps://beian.aliyun.com/
   - æˆ–ä» ECS æ§åˆ¶å°è¿›å…¥ï¼šå¤‡æ¡ˆ â†’ ICPå¤‡æ¡ˆ

2. **å¼€å§‹å¤‡æ¡ˆ**
   - ç‚¹å‡»"å¼€å§‹å¤‡æ¡ˆ"
   - é€‰æ‹©å¤‡æ¡ˆç±»å‹ï¼šé¦–æ¬¡å¤‡æ¡ˆ

3. **å¡«å†™ä¸»ä½“ä¿¡æ¯**ï¼ˆä¸ªäººå¤‡æ¡ˆï¼‰
   - è¯ä»¶ç±»å‹ï¼šèº«ä»½è¯
   - è¯ä»¶å·ç ï¼šå¡«å†™èº«ä»½è¯å·
   - å§“åï¼šå¡«å†™çœŸå®å§“å
   - æ‰‹æœºå·ç ï¼šå¡«å†™æ‰‹æœºå·
   - é‚®ç®±ï¼šå¡«å†™é‚®ç®±

4. **å¡«å†™ç½‘ç«™ä¿¡æ¯**
   - ç½‘ç«™åç§°ï¼šæ ¼å¼ä¿®æ”¹å™¨ï¼ˆæˆ–ä½ çš„ç½‘ç«™åç§°ï¼‰
   - ç½‘ç«™åŸŸåï¼šgeshixiugai.cn
   - ç½‘ç«™æœåŠ¡å†…å®¹ï¼šå…¶ä»–
   - ç½‘ç«™è¯­è¨€ï¼šä¸­æ–‡
   - ç½‘ç«™é¦–é¡µURLï¼šhttps://geshixiugai.cn
   - ç½‘ç«™ç®€ä»‹ï¼šæä¾›Wordæ–‡æ¡£æ ¼å¼ä¿®æ”¹æœåŠ¡

5. **ä¸Šä¼ èµ„æ–™**
   - èº«ä»½è¯æ­£åé¢ç…§ç‰‡
   - ç½‘ç«™çœŸå®æ€§æ ¸éªŒå•ï¼ˆç³»ç»Ÿä¼šç”Ÿæˆï¼Œä¸‹è½½æ‰“å°åç­¾å­—ä¸Šä¼ ï¼‰

6. **æäº¤å®¡æ ¸**
   - ç¡®è®¤ä¿¡æ¯æ— è¯¯åæäº¤
   - ç­‰å¾…åˆå®¡ï¼ˆé€šå¸¸ 1-2 ä¸ªå·¥ä½œæ—¥ï¼‰

### 9.3 å®Œæˆæ ¸éªŒ

åˆå®¡é€šè¿‡åï¼š
1. **æ‰‹æœºçŸ­ä¿¡æ ¸éªŒ**ï¼šæ”¶åˆ°çŸ­ä¿¡åï¼Œç‚¹å‡»é“¾æ¥å®Œæˆæ ¸éªŒ
2. **äººè„¸è¯†åˆ«æ ¸éªŒ**ï¼ˆéƒ¨åˆ†æœåŠ¡å•†è¦æ±‚ï¼‰
3. **ç­‰å¾…ç®¡å±€å®¡æ ¸**ï¼ˆ7-20 ä¸ªå·¥ä½œæ—¥ï¼‰

### 9.4 å¤‡æ¡ˆé€šè¿‡å

1. **è·å–å¤‡æ¡ˆå·**ï¼šå¦‚ `æµ™ICPå¤‡12345678å·-1`
2. **åœ¨ç½‘ç«™åº•éƒ¨æ·»åŠ å¤‡æ¡ˆå·**ï¼šä¿®æ”¹å‰ç«¯é¡µé¢ï¼Œæ·»åŠ å¤‡æ¡ˆå·æ˜¾ç¤º
3. **æ›´æ–°æ”¯ä»˜é…ç½®**ï¼šåœ¨æ”¯ä»˜å®/å¾®ä¿¡æ”¯ä»˜é…ç½®ä¸­å¡«å†™å¤‡æ¡ˆå·

---

## æ­¥éª¤ 10ï¼šé…ç½®æ”¯ä»˜æ¥å£

### 10.1 æ›´æ–°æ”¯ä»˜å›è°ƒåœ°å€

åœ¨æ”¯ä»˜å®/å¾®ä¿¡æ”¯ä»˜é…ç½®ä¸­ï¼Œæ›´æ–°å›è°ƒåœ°å€ä¸ºï¼š
- `https://geshixiugai.cn/payments/alipay/notify`
- `https://geshixiugai.cn/payments/wechat/notify`

### 10.2 æ›´æ–°æ”¯ä»˜é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­ç¡®ä¿æ”¯ä»˜é…ç½®æ­£ç¡®ï¼š
- æ”¯ä»˜å® AppIDã€ç§é’¥ã€å…¬é’¥
- å¾®ä¿¡æ”¯ä»˜ AppIDã€å•†æˆ·å·ã€API å¯†é’¥

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# Gunicorn æœåŠ¡æ—¥å¿—
sudo journalctl -u geshixiugai -f

# Nginx è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/geshixiugai_access.log

# Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/geshixiugai_error.log

# Gunicorn æ—¥å¿—
sudo tail -f /var/log/geshixiugai/access.log
sudo tail -f /var/log/geshixiugai/error.log
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯ Gunicorn
sudo systemctl restart geshixiugai

# é‡å¯ Nginx
sudo systemctl restart nginx

# é‡æ–°åŠ è½½ Nginx é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
sudo systemctl reload nginx
```

### æ›´æ–°ä»£ç 

```bash
cd /var/www/geshixiugai
git pull
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart geshixiugai
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶å¤§å°é™åˆ¶

- **Nginx**ï¼š`client_max_body_size 50m;`ï¼ˆå·²åœ¨é…ç½®ä¸­è®¾ç½®ï¼‰
- **ä»£ç ä¸­**ï¼šæ£€æŸ¥ `backend/app/api/documents.py` ä¸­çš„ `MAX_FILE_SIZE` è®¾ç½®

### 2. å®‰å…¨é…ç½®

- å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–åŒ…
- é…ç½®é˜²ç«å¢™ï¼ˆUFWï¼‰
- ä½¿ç”¨å¼ºå¯†ç 
- å®šæœŸå¤‡ä»½æ•°æ®

### 3. æ€§èƒ½ä¼˜åŒ–

- æ ¹æ®è®¿é—®é‡è°ƒæ•´ Gunicorn workers æ•°é‡
- é…ç½® Nginx ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
- ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æºï¼ˆå¯é€‰ï¼‰

### 4. å¤‡ä»½

å®šæœŸå¤‡ä»½ï¼š
- ä»£ç ï¼ˆGit ä»“åº“ï¼‰
- ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆ`.env`ï¼‰
- æ•°æ®åº“ï¼ˆå¦‚æœæœ‰ï¼‰
- å­˜å‚¨çš„æ–‡ä»¶ï¼ˆSupabase/R2/B2 é€šå¸¸æœ‰è‡ªåŠ¨å¤‡ä»½ï¼‰

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status geshixiugai

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u geshixiugai -n 50

# æ£€æŸ¥ Python ç¯å¢ƒ
cd /var/www/geshixiugai
source venv/bin/activate
python -c "import backend.app.main"
```

### é—®é¢˜ 2ï¼š502 Bad Gateway

- æ£€æŸ¥ Gunicorn æ˜¯å¦è¿è¡Œï¼š`sudo systemctl status geshixiugai`
- æ£€æŸ¥ç«¯å£ 8000 æ˜¯å¦ç›‘å¬ï¼š`sudo netstat -tlnp | grep 8000`
- æ£€æŸ¥ Nginx é…ç½®ï¼š`sudo nginx -t`

### é—®é¢˜ 3ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥

- æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶
- æ£€æŸ¥å­˜å‚¨é…ç½®æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`sudo journalctl -u geshixiugai -f`

### é—®é¢˜ 4ï¼šåŸŸåæ— æ³•è®¿é—®

- æ£€æŸ¥ DNS è§£ææ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æœåŠ¡å™¨å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 80/443 ç«¯å£
- æ£€æŸ¥ Nginx é…ç½®æ˜¯å¦æ­£ç¡®

---

## âœ… è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] è´­ä¹°é˜¿é‡Œäº‘ ECS æœåŠ¡å™¨
- [ ] è´­ä¹°åŸŸå geshixiugai.cn
- [ ] å®ŒæˆåŸŸåå®åè®¤è¯
- [ ] é…ç½®æœåŠ¡å™¨ç¯å¢ƒï¼ˆPythonã€Nginxï¼‰
- [ ] éƒ¨ç½²åº”ç”¨ä»£ç 
- [ ] é…ç½®ç¯å¢ƒå˜é‡
- [ ] é…ç½® Nginx åå‘ä»£ç†
- [ ] é…ç½® Gunicorn å’Œ Systemd æœåŠ¡
- [ ] é…ç½® SSL è¯ä¹¦
- [ ] é…ç½®åŸŸåè§£æ
- [ ] æµ‹è¯•åº”ç”¨åŠŸèƒ½
- [ ] æäº¤ ICP å¤‡æ¡ˆ
- [ ] å®Œæˆå¤‡æ¡ˆå®¡æ ¸
- [ ] æ›´æ–°æ”¯ä»˜é…ç½®
- [ ] åœ¨ç½‘ç«™åº•éƒ¨æ·»åŠ å¤‡æ¡ˆå·
- [ ] æœ€ç»ˆæµ‹è¯•å’Œä¸Šçº¿

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å®šä½é—®é¢˜
2. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
3. å‚è€ƒé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£
4. è”ç³»é˜¿é‡Œäº‘æŠ€æœ¯æ”¯æŒ

---

**è¿ç§»å®Œæˆåï¼Œä½ çš„ç½‘ç«™å°†åœ¨ `https://geshixiugai.cn` æ­£å¸¸è¿è¡Œï¼** ğŸ‰



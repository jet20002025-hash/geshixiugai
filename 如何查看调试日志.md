# 如何查看调试日志

## 📍 日志位置

根据你的部署方式，日志会在不同的地方：

### 方式 1：Vercel 部署（生产环境）

如果你的项目部署在 Vercel 上，日志在 **Vercel Dashboard** 中：

#### 查看步骤：

1. **登录 Vercel Dashboard**
   - 访问：https://vercel.com/dashboard
   - 使用你的账号登录

2. **进入项目**
   - 在项目列表中找到你的项目（如 `geshixiugai`）
   - 点击进入项目详情页

3. **查看日志**
   - 点击顶部的 **"Functions"** 标签
   - 然后点击 **"Logs"** 标签
   - 或者直接点击左侧菜单的 **"Logs"**

4. **筛选日志**
   - 在日志页面，你可以：
     - 选择时间范围（最近1小时、24小时、7天等）
     - 搜索关键词，如：`[DocumentService]`、`[4]`、`[5]` 等
     - 查看特定函数的日志

5. **查找调试信息**
   - 搜索以下关键词：
     - `[DocumentService]` - 所有文档服务的日志
     - `检测到` - 引用检测相关的日志
     - `调试` - 调试信息
     - `[4]` 或 `[5]` - 特定引用的日志

#### 日志示例：

```
[DocumentService] 正文开始位置: 10, 参考文献开始位置: 150
[DocumentService] 调试：段落 25 包含引用
[DocumentService] 段落文本: ...扩展[4]...
[DocumentService] 在正文中找到 1 个 [4]，位置: [1234]
[DocumentService] 从单个编号格式中检测到引用: [4] (位置: 1234, 上下文: ...扩展[4]...)
```

---

### 方式 2：本地运行（开发环境）

如果你在本地运行项目，日志会直接输出到**终端/控制台**：

#### 查看步骤：

1. **启动项目**
   ```bash
   cd /Users/zwj/word格式修改器
   # 根据你的启动方式运行项目
   ```

2. **查看终端输出**
   - 所有 `print()` 语句的输出都会显示在终端中
   - 查找以 `[DocumentService]` 开头的日志

3. **保存日志到文件（可选）**
   ```bash
   # 运行项目并将输出保存到日志文件
   python -m uvicorn backend.app.main:app --reload 2>&1 | tee debug.log
   ```
   这样日志会同时显示在终端和保存到 `debug.log` 文件中

---

### 方式 3：通过 API 响应查看

如果日志信息包含在 API 响应中，你可以：

1. **打开浏览器开发者工具**（按 F12）
2. **切换到 Network 标签**
3. **上传文档并处理**
4. **查看 API 响应**
   - 找到文档处理的 API 请求（通常是 `/documents/upload` 或 `/documents/{id}/process`）
   - 查看响应内容，可能包含调试信息

---

## 🔍 关键日志信息

查找以下关键信息来诊断问题：

### 1. 正文范围信息
```
[DocumentService] 正文开始位置: X, 参考文献开始位置: Y
```
- 检查这两个位置是否合理
- 如果 `正文开始位置` 太大，可能跳过了包含引用的段落

### 2. 段落文本信息
```
[DocumentService] 调试：段落 X 包含引用
[DocumentService] 段落文本: ...
```
- 检查段落文本是否正确提取
- 检查是否包含 `[4]` 和 `[5]`

### 3. 正文文本检查
```
[DocumentService] 在正文中找到 X 个 [4]，位置: [...]
[DocumentService] 警告：正文文本中未找到 [4]
```
- 如果显示"未找到"，说明文本提取有问题
- 如果显示"找到 X 个"，检查是否正确提取了编号

### 4. 引用检测信息
```
[DocumentService] 从单个编号格式中检测到引用: [4]
[DocumentService] 通过字符串搜索检测到引用: [4]
```
- 检查是否检测到了引用
- 检查检测方式（正则表达式还是字符串搜索）

### 5. 最终结果
```
[DocumentService] 检测到 X 条参考文献
[DocumentService] 参考文献编号: [1, 2, 3, 4, 5]
[DocumentService] 正文中引用的编号: [1, 2, 3]
[DocumentService] 未引用的参考文献: 4 - ...
[DocumentService] 未引用的参考文献: 5 - ...
```
- 检查参考文献编号列表
- 检查正文中引用的编号列表
- 检查未引用的参考文献

---

## 🛠️ 如果看不到日志

### 问题 1：Vercel 日志为空

**可能原因**：
- 日志被清空了（Vercel 只保留最近一段时间的日志）
- 函数还没有执行

**解决方法**：
1. 重新上传文档并处理
2. 立即查看日志（不要等待太久）

### 问题 2：本地运行看不到日志

**可能原因**：
- 输出被重定向了
- 日志级别设置问题

**解决方法**：
1. 确保使用 `print()` 语句（代码中已经添加）
2. 检查终端是否有输出
3. 尝试直接运行 Python 文件测试

### 问题 3：日志太多，找不到关键信息

**解决方法**：
1. 在 Vercel 日志页面使用搜索功能
2. 搜索关键词：`[DocumentService]`、`[4]`、`[5]`、`检测到` 等
3. 只查看最近的处理请求的日志

---

## 📝 提供日志信息

如果问题仍然存在，请提供以下信息：

1. **Vercel 日志截图或文本**（包含 `[DocumentService]` 的所有日志）
2. **正文开始位置和参考文献开始位置**
3. **是否找到 [4] 和 [5] 的日志**
4. **检测到的引用编号列表**
5. **未引用的参考文献列表**

这样我可以更准确地定位问题！


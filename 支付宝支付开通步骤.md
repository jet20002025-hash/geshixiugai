# 支付宝支付开通步骤（个体工商户）

## 一、申请支付宝开放平台账号

### 1.1 访问申请入口

**官网**：https://open.alipay.com/

### 1.2 注册/登录

1. 使用支付宝账号登录（如果没有，先注册支付宝账号）
2. 选择"企业入驻"（个体工商户选择企业类型）

### 1.3 填写资料

**需要准备的材料**：
- 营业执照照片（彩色扫描件）
- 法人身份证正反面照片
- 结算银行卡信息（法人名下）
- 联系人信息

**填写步骤**：
1. 选择主体类型：**个体工商户**
2. 填写营业执照信息：
   - 统一社会信用代码
   - 企业名称
   - 注册地址
   - 经营范围
3. 填写法人信息：
   - 法人姓名
   - 法人身份证号
   - 法人手机号
4. 填写结算账户信息：
   - 开户银行
   - 银行账号
   - 账户名称（法人姓名）
5. 上传证件照片：
   - 营业执照照片
   - 法人身份证正反面
   - 银行开户证明（可选）

### 1.4 等待审核

- **审核时间**：1-3 个工作日
- **审核通过后**：会收到通知，可以开始创建应用

---

## 二、创建应用并获取 AppID

### 2.1 登录开放平台

1. 访问：https://open.alipay.com/
2. 使用支付宝账号登录
3. 进入"控制台"

### 2.2 创建应用

**步骤**：
1. 在控制台首页，点击"**网页&移动应用**"
2. 点击"**创建应用**"按钮
3. 选择应用类型：**"手机网站支付"**（推荐）
   - ✅ 适合PC和移动端
   - ✅ 用户体验好
   - ✅ 接入简单
4. 填写应用信息：
   - **应用名称**：例如"论文格式修复服务"
   - **应用图标**：上传应用图标（建议 200x200 像素）
   - **应用描述**：填写应用功能描述
   - **应用官网**：https://geshixiugai.org
5. 点击"**提交审核**"

### 2.3 等待应用审核

- **审核时间**：通常几小时到1个工作日
- **审核通过后**：在应用列表中可以看到应用

### 2.4 获取 AppID

1. 在应用列表中，点击你创建的应用
2. 在应用详情页面，可以看到 **AppID**
3. **复制保存**这个 AppID，这就是 `ALIPAY_APP_ID`

**AppID 格式示例**：
```
2021001234567890
```

---

## 三、生成密钥对

### 3.1 下载密钥生成工具

**方式一：使用支付宝官方工具**
1. 在应用详情页面，找到"开发信息"
2. 点击"接口加签方式" → "设置"
3. 页面会提供密钥生成工具下载链接

**方式二：使用在线工具**
- 访问：https://opendocs.alipay.com/common/02kkv7
- 使用在线密钥生成工具

### 3.2 生成密钥对

**使用工具生成**：
1. 打开密钥生成工具
2. 选择密钥类型：**RSA2（推荐）**
3. 选择密钥长度：**2048位**
4. 选择密钥格式：**PKCS8**
5. 点击"**生成密钥**"

**会生成两个密钥**：
- **应用私钥**（private_key）：这是 `ALIPAY_PRIVATE_KEY`
  - ⚠️ **非常重要**：请立即复制保存，只显示一次！
  - ⚠️ **不要泄露**：这是你的私钥，泄露后需要重新生成
- **应用公钥**（public_key）：需要上传到支付宝

**密钥格式示例**：
```
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...
（很长的一串字符）
-----END PRIVATE KEY-----
```

---

## 四、上传应用公钥并获取支付宝公钥

### 4.1 上传应用公钥

**步骤**：
1. 在应用详情页面，找到"**开发信息**"
2. 找到"**接口加签方式**" → 点击"**设置**"
3. 选择加签方式：**"公钥"**
4. 将刚才生成的 **应用公钥**（public_key）粘贴进去
   - 注意：只粘贴公钥内容，包括 `-----BEGIN PUBLIC KEY-----` 和 `-----END PUBLIC KEY-----`
5. 点击"**保存**"

### 4.2 获取支付宝公钥

**步骤**：
1. 保存应用公钥后，支付宝会自动生成 **支付宝公钥**
2. 在"接口加签方式"页面可以看到支付宝公钥
3. **复制保存**这个支付宝公钥，这就是 `ALIPAY_PUBLIC_KEY`

**支付宝公钥格式示例**：
```
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
（很长的一串字符，没有 BEGIN/END 标记）
```

---

## 五、获取商户号（可选）

### 5.1 查找商户号

**位置**：开放平台控制台首页

**步骤**：
1. 登录支付宝开放平台
2. 在控制台首页可以看到"**商户号**"或"**PID**"
3. **复制保存**这个商户号，这就是 `ALIPAY_PARTNER_ID`

**注意**：
- 新版本的支付宝可能不显示 partner_id
- 如果找不到，可以联系支付宝客服获取
- 或者在某些接口中，partner_id 已经不再使用（主要使用 app_id）

---

## 六、配置信息总结

完成以上步骤后，你应该获得以下配置信息：

| 配置项 | 环境变量名 | 获取位置 | 是否必需 |
|--------|-----------|---------|---------|
| **应用ID** | `ALIPAY_APP_ID` | 应用详情页 | ✅ 必需 |
| **应用私钥** | `ALIPAY_PRIVATE_KEY` | 密钥生成工具 | ✅ 必需 |
| **支付宝公钥** | `ALIPAY_PUBLIC_KEY` | 上传公钥后获取 | ✅ 必需 |
| **商户号** | `ALIPAY_PARTNER_ID` | 控制台首页 | ⚠️ 可选 |
| **网关地址** | `ALIPAY_GATEWAY` | 固定值 | ✅ 必需 |
| **签名类型** | `ALIPAY_SIGN_TYPE` | 固定值 | ✅ 必需 |

---

## 七、在 Vercel 中配置环境变量

### 7.1 访问 Vercel 项目设置

1. 登录 Vercel Dashboard：https://vercel.com/dashboard
2. 选择你的项目：`geshixiugai`
3. 进入 **Settings** → **Environment Variables**

### 7.2 添加环境变量

添加以下环境变量：

#### 必需配置

```
ALIPAY_APP_ID=你的应用ID
ALIPAY_PRIVATE_KEY=你的应用私钥（完整内容，包括BEGIN/END标记）
ALIPAY_PUBLIC_KEY=支付宝公钥（完整内容）
ALIPAY_GATEWAY=https://openapi.alipay.com/gateway.do
ALIPAY_SIGN_TYPE=RSA2
```

#### 可选配置

```
ALIPAY_PARTNER_ID=你的商户号（如果找到了）
```

### 7.3 配置注意事项

**重要**：
1. **私钥格式**：必须包含完整的 `-----BEGIN PRIVATE KEY-----` 和 `-----END PRIVATE KEY-----`
2. **公钥格式**：支付宝公钥通常没有 BEGIN/END 标记，直接粘贴即可
3. **换行符**：在 Vercel 环境变量中，多行内容需要正确处理
   - 建议：将私钥和公钥转换为单行（去掉换行符，用 `\n` 代替）
   - 或者：使用 Vercel 的多行文本输入

### 7.4 配置步骤

1. 在 Vercel Dashboard 中，点击 **Add New**
2. 输入变量名：`ALIPAY_APP_ID`
3. 输入变量值：你的应用ID（例如：`2021001234567890`）
4. 选择环境：**All Environments**
5. 点击 **Save**
6. 重复上述步骤，添加其他环境变量

**对于私钥和公钥（多行内容）**：
- 在 Vercel 中，可以粘贴多行内容
- 或者转换为单行格式（用 `\n` 代替换行符）

---

## 八、重新部署

配置完成后：

1. 在 Vercel Dashboard 中，进入 **Deployments**
2. 点击最新部署右侧的 **...** 菜单
3. 选择 **Redeploy**
4. 等待部署完成（约 1-2 分钟）

---

## 九、测试支付

部署完成后：

1. 访问网站：https://geshixiugai.org/web/
2. 上传模板和文档
3. 处理完成后，选择"**支付宝**"支付方式
4. 点击"**立即支付**"
5. 应该会跳转到支付宝支付页面

---

## 十、常见问题

### Q1: 应用审核需要多长时间？

**A**: 通常几小时到1个工作日，具体时间以支付宝审核为准。

### Q2: 密钥生成后找不到私钥了怎么办？

**A**: 需要重新生成密钥对，然后重新上传公钥到支付宝。

### Q3: 私钥和公钥格式要求是什么？

**A**: 
- 应用私钥：必须是 PKCS8 格式，包含 BEGIN/END 标记
- 支付宝公钥：通常没有 BEGIN/END 标记，直接使用

### Q4: 找不到商户号（partner_id）怎么办？

**A**: 
- 新版本的支付宝可能不再使用 partner_id
- 如果接口报错需要 partner_id，可以联系支付宝客服获取
- 或者查看应用详情页面是否有相关信息

### Q5: 环境变量中的私钥格式不对怎么办？

**A**: 
- 确保包含完整的 `-----BEGIN PRIVATE KEY-----` 和 `-----END PRIVATE KEY-----`
- 如果 Vercel 不支持多行，可以转换为单行（用 `\n` 代替换行符）

---

## 十一、下一步

获取到所有配置信息后，告诉我，我可以帮你：

1. ✅ 集成支付宝支付接口
2. ✅ 更新前端支付逻辑
3. ✅ 配置支付回调处理
4. ✅ 测试支付流程

**准备好配置信息后，告诉我即可开始集成！**

